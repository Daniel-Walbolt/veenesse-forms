var A=(a,e,t)=>new Promise((i,o)=>{var r=n=>{try{V(t.next(n))}catch(l){o(l)}},d=n=>{try{V(t.throw(n))}catch(l){o(l)}},V=n=>n.done?i(n.value):Promise.resolve(n.value).then(r,d);V((t=t.apply(a,e)).next())});function O(a){let e=0,t;return(...i)=>{var r;let o=++e;return t=(r=t==null?void 0:t.then(()=>{if(e===o)return t=a(...i).then(d=>(t=void 0,d)),t}))!=null?r:a(...i).then(d=>(t=void 0,d)),t}}function $(a,e){let t=0,i;return(...o)=>new Promise(r=>{let d=++t,V=new Date().getTime();i!=null||(i=V-e);let n=V-i-e;n<0?new Promise(l=>setTimeout(l,-1*n)).then(()=>{i=new Date().getTime(),d===t&&r(a(...o)),r(void 0)}):(i=V,r(a(...o)))})}function M(a,e=t=>t){return a.reduce((t,i)=>{if(i!==void 0){let o=e(i);o!==void 0&&t.push(o)}return t},[])}function k(a){return a.reduce((e,t)=>{if(t!==void 0)if(t instanceof Array)for(let i of t)i!==void 0&&e.push(i);else e.push(t);return e},[])}function _(){return a=>({isValid:a.value!==void 0&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function aa(a,e){return t=>A(this,null,function*(){return(yield a(t))===!1?{isValid:!0}:e})}function ea(a){return e=>{var i;let t=String((i=e.value)!=null?i:"");return{isValid:t.length>=a,errorMessage:`Too short (${t.length} / ${a})`}}}function ta(a){return e=>{var i;let t=String((i=e.value)!=null?i:"");return{isValid:t.length<=a,errorMessage:`Too long (${t.length} / ${a})`}}}function ia(a){return e=>({isValid:e.value!==void 0&&e.value>=a,errorMessage:`The minimum value is ${a}`})}function na(a){return e=>({isValid:e.value!==void 0&&e.value<=a,errorMessage:`The maximum value is ${a}`})}function ra(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}import{ref as J,computed as x,watch as Z,reactive as w}from"vue";import{computed as q}from"vue";import{computed as g,reactive as L,ref as b}from"vue";function N(){return`${Date.now()}-${Math.floor(Math.random()*1e3)}`}function h(a,e,t){let i=[],o=r=>`${e?"reactive":"lazy"}-${N()}`;t!=null&&(o=r=>`${t}-${r}`);for(let[r,d]of a.entries())i.push({validatorId:o(r),validator:d,optimized:!1,isReactive:e,previouslyReturnedValidators:!1,previouslySpawnedValidators:{},spawnedValidators:{}});return i}function G(a,e,t=[]){var l,y,u,s;let i=L({isValid:g(()=>{var P,f;let c=(P=n.isLazyValid.value)!=null?P:!1,v=(f=n.isReactiveValid.value)!=null?f:!1;return c&&v}),isValidating:g(()=>n.isValidatingReactive.value||n.isValidatingLazy.value),isErrored:g(()=>i.resultsArray.some(c=>c.isValid===!1)),errorMessages:g(()=>k(M(i.resultsArray,c=>c.isValid?void 0:c.errorMessage))),results:g(()=>n.namedValidationResults.value),resultsArray:g(()=>n.validationResults.value),arrayState:g(()=>{if(Array.isArray(a.value)===!1||n.elementValidation===void 0)return[];console.time("Array state");let c=a.value,v=n.elementValidation,P=n.arrayConfigMap,f=[],p={},m,I=[];for(let R=0;R<c.length;R++){if(c[R]!==void 0&&typeof c[R]=="object"?(c[R].$ffId===void 0&&Object.defineProperty(c[R],"$ffId",{value:`${n.id}-${n.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),m=c[R].$ffId):c[R]!==void 0&&(m=R),I.push(m),P[m]){f.push(P[m].validationState),p[m]=P[m];continue}if(S(v)){let T=g(()=>c[R]),F=G(T,v,n.arrayParents);P[m]={validationConfigs:[F],validationState:F.validationState}}else{let T=c[R],F=z(T,v,n.arrayParents.concat(T));P[m]={validationConfigs:F.validationConfigs,validationState:F.state}}f.push(P[m].validationState),p[m]=P[m]}return n.arrayConfigMap=p,console.timeEnd("Array state"),f})}),o=!(((y=(l=e.$lazy)==null?void 0:l.length)!=null?y:-1)>0),r=!(((s=(u=e.$reactive)==null?void 0:u.length)!=null?s:-1)>0),d=e.$reactive?h(e.$reactive,!0):[],V=e.$lazy?h(e.$lazy,!1):[],n={id:N(),validationIterationId:0,isReactiveValid:b(r),isValidatingReactive:b(!1),reactiveProcessedValidators:d,isLazyValid:b(o),isValidatingLazy:b(!1),lazyProcessedValidators:V,property:a,validation:e,validationState:i,validationResults:b([]),namedValidationResults:b({}),arrayConfigMap:{},elementId:0,elementValidation:e.$each,arrayParents:L(t)};return n}function z(a,e,t=[]){let i=[],o={};e!==void 0&&r(a,e);function r(d,V){for(let n in V){let l=g(()=>d[n]);if(S(V[n])){let y=V[n],u=G(l,y,t);i.push(u),o[n]=u.validationState}else{let y={},u=V[n];o[n]=y,r(l,u)}}}return{validationConfigs:i,state:o}}function S(a){return(a==null?void 0:a.$reactive)!==void 0||(a==null?void 0:a.$lazy)!==void 0||(a==null?void 0:a.$each)!==void 0}var j=500;function B(a,e,t,i,o){return A(this,null,function*(){let r=!0,d=(l,y,u)=>{if(i!==l.validationIterationId)return;u.isValid===!1&&(r=!1),u.id=y.validatorId;let s=l.validationResults.value.find(c=>c.id===u.id);s!==void 0?(Object.assign(s,u),u.name!==void 0&&l.namedValidationResults[u.name]!==void 0&&Object.assign(l.namedValidationResults.value[u.name],u)):(l.validationResults.value.push(u),u.name!==void 0&&(l.namedValidationResults.value[u.name]=u))},{asyncPromises:V,validatorsWhichPreviouslyReturnedValidators:n}=C(a,e,t,i,o,d,!0,1);if(yield Promise.all(V),i===a.validationIterationId){for(let l of n)for(let y of Object.keys(l.previouslySpawnedValidators))if(l.spawnedValidators[y]==null){let u=a.validationResults.value.findIndex(s=>s.id===y);u!==-1&&a.validationResults.value.splice(u)}}return r})}function C(a,e,t,i,o,r,d,V){let n=a.property.value,l=[],y=[],u=[];for(let s of o){let c=!1;s.previouslyReturnedValidators&&(s.previouslySpawnedValidators=s.spawnedValidators,s.spawnedValidators={},c=!0),s.previouslyReturnedValidators=!1;let v;if(s.computedValidator===void 0){let P={value:n,parent:e,args:t,arrayParents:a.arrayParents};v=s.validator(P)}else v=s.computedValidator.value;if(v instanceof Promise){let P=Date.now();l.push(v.then(f=>A(this,null,function*(){if(f===void 0){c&&u.push(s);return}let p=Date.now()-P;if(d&&p>j&&s.optimized===!1&&(s.optimized=!0,p<2*j?s.validator=$(s.validator,j):s.validator=O(s.validator)),Array.isArray(f)){let{asyncPromises:m,syncResults:I}=D(a,e,t,i,r,s,f,V);y.push(...I),yield Promise.all(m);return}else c&&u.push(s);r(a,s,f)})))}else if(Array.isArray(v)){let{asyncPromises:P,syncResults:f}=D(a,e,t,i,r,s,v,V);l.push(...P),y.push(...f)}else if(c&&u.push(s),v!==void 0){if(d&&s.optimized===!1){let P=s.validator;s.computedValidator=q(()=>{let f={value:a.property.value,parent:e,args:t,arrayParents:a.arrayParents};return P(f)}),s.optimized=!0,s.validator=()=>s.computedValidator.value}y.push(v),r(a,s,v)}}return{asyncPromises:l,syncResults:y,validatorsWhichPreviouslyReturnedValidators:u}}function D(a,e,t,i,o,r,d,V){let n=h(d,r.isReactive,r.validatorId),l=C(a,e,t,i,n,o,!1,++V),y={};for(let u of n)y[u.validatorId]=u;return r.spawnedValidators=y,r.previouslyReturnedValidators=!0,l}function E(a,e,t,i){return A(this,null,function*(){a.isValidatingReactive.value=!0;let o=yield B(a,e,t,i,a.reactiveProcessedValidators);return i===a.validationIterationId&&(a.isReactiveValid.value=o,a.isValidatingReactive.value=!1),a.isReactiveValid.value})}function U(a,e,t,i){return A(this,null,function*(){a.isValidatingLazy.value=!0;let o=a.lazyProcessedValidators,r=yield B(a,e,t,i,o);return i===a.validationIterationId&&(a.isLazyValid.value=r,a.isValidatingLazy.value=!1),a.isLazyValid.value})}function K(a,e,t,i,o){return A(this,null,function*(){let r=[];for(let d of a){let V=++d.validationIterationId;if(i&&d.validation.$reactive!==void 0&&r.push(yield E(d,e.value,t,V)),o&&d.validation.$lazy!==void 0&&r.push(yield U(d,e.value,t,V)),d.elementValidation!==void 0){let n=[];for(let l in d.arrayConfigMap)n.push(...d.arrayConfigMap[l].validationConfigs);r.push(yield K(n,e,t,i,o))}}return Promise.all(r).then(d=>d.every(V=>V===!0))})}function W(a){var P;(P=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:e,validation:t,delayReactiveValidation:i,args:o}=a,r=J(!1),d=x(()=>n.some(f=>f.validationState.isValidating)),V=x(()=>n.every(p=>p.isReactiveValid.value&&p.isLazyValid.value)),n=[],l=w({}),y=J(JSON.stringify(a.objectToValidate.value)),u=x(()=>y.value!==JSON.stringify(a.objectToValidate.value));if(S(t)){let m=G(e,t);l=w(m.validationState),n=[m]}else{let f=e,p=t,m=z(f.value,p);l=w(m.state),n=m.validationConfigs}Z(a.objectToValidate,()=>{i?r.value===!0&&K(n,e,o,!0,!1):K(n,e,o,!0,!1)},{deep:!0});function c(){return A(this,null,function*(){let f=yield K(n,e,o,!0,!0);return r.value=!0,f})}function v(f){y.value=JSON.stringify(f)}return w({hasValidated:r,validate:c,isValidating:d,propertyState:x(()=>l),isValid:V,setReference:v,isDirty:u})}export{O as bufferAsync,ra as isEmailSync,ta as maxLength,na as maxNumber,ea as minLength,ia as minNumber,_ as required,$ as throttleQueueAsync,W as useValidation,aa as validateIf};
