var p=(a,t,e)=>new Promise((i,s)=>{var o=r=>{try{u(e.next(r))}catch(l){s(l)}},n=r=>{try{u(e.throw(r))}catch(l){s(l)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(o,n);u((e=e.apply(a,t)).next())});function x(a){let t=0,e;return(...i)=>{var o;let s=++t;return e=(o=e==null?void 0:e.then(()=>{if(t==s)return e=a(...i).then(n=>(e=void 0,n)),e}))!=null?o:a(...i).then(n=>(e=void 0,n)),e}}function F(a,t){let e=0,i;return(...s)=>new Promise(o=>{let n=++e,u=new Date().getTime();i!=null||(i=u-t);let r=u-i-t;r<0?new Promise(l=>setTimeout(l,-1*r)).then(()=>{i=new Date().getTime(),n==e&&o(a(...s)),o(void 0)}):(i=u,o(a(...s)))})}function K(a,t=e=>e){return a.reduce((e,i)=>{if(i!=null){let s=t(i);s!=null&&e.push(s)}return e},[])}function h(a){return a.reduce((t,e)=>{if(e!=null)if(e instanceof Array)for(let i of e)i!=null&&t.push(i);else t.push(e);return t},[])}function D(){return a=>({isValid:a.value!=null&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function J(a,t){return e=>p(this,null,function*(){if(a(e.parent,e.args)==!1)return{isValid:!0};let i=[],s=[];for(let r of t){let l=r(e);l instanceof Promise?i.push(l):s.push(l)}let o=yield Promise.all(i);s.push(...K(o));let n=s.filter(r=>!r.isValid).map(r=>r.errorMessage),u=h(n);return{isValid:s.every(r=>r.isValid==!0),errorMessage:u}})}function Q(a){return t=>{var i;let e=String((i=t.value)!=null?i:"");return{isValid:e.length>=a,errorMessage:`Too short (${e.length} / ${a})`}}}function U(a){return t=>{var e,i,s,o;return{isValid:((i=(e=t.value)==null?void 0:e.length)!=null?i:0)<=a,errorMessage:`Too long (${(o=(s=t.value)==null?void 0:s.length)!=null?o:0} / ${a})`}}}function Z(a){return t=>({isValid:t.value!=null&&t.value>=a,errorMessage:`Must be atleast ${a}`})}function q(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}import{ref as g,computed as m,watch as M,reactive as b}from"vue";var j=g(0);function w(a){var P;(P=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:t,validation:e,delayReactiveValidation:i,args:s}=a,o=g(!1),n=m(()=>r.some(R=>R.validationState.isValidating)),u=m(()=>r.every(A=>A.reactiveIsValid.value&&A.lazyIsValid.value)),r=[],l=b({}),y=g(JSON.stringify(a.objectToValidate.value)),V=m(()=>y.value!==JSON.stringify(a.objectToValidate.value));if((e==null?void 0:e.$reactive)!=null||(e==null?void 0:e.$lazy)!=null||(e==null?void 0:e.$each)!=null){let v=$(t,e);l=b(v.validationState),r=[v]}else{let R=t,A=e,v=G(R.value,A);l=b(v.state),r=v.validationConfigs}M(a.objectToValidate,()=>{i?o.value==!0&&S(r,t,s,!0,!1):S(r,t,s,!0,!1)},{deep:!0});function c(){return p(this,null,function*(){let R=yield S(r,t,s,!0,!0);return o.value=!0,R})}function f(R){y.value=JSON.stringify(R)}return b({hasValidated:o,validate:c,isValidating:n,propertyState:l,isValid:u,setReference:f,isDirty:V})}function k(a,t,e,i){return p(this,null,function*(){var y,V;if(a.validation.$reactive==null)return!0;a.validatingReactive.value=!0;let s=a.validation.$reactive,o=!0;(a.syncValidators.$reactive||a.asyncValidators.$reactive)&&(o=!1,s=((y=a.syncValidators.$reactive)!=null?y:[]).concat((V=a.asyncValidators.$reactive)!=null?V:[]));let n=!0,u=0;function r(d){let c;if(i==a.validationIterationId)for(let f=0;f<d.length;f++)d[f].isValid==!1&&(n=!1),d[f].identifier=`validator-reactive-${a.id}-${u++}`,c=a.reactiveValidationResults.value.find(P=>P.identifier==d[f].identifier),c!=null?Object.assign(c,d[f]):a.reactiveValidationResults.value.push(d[f])}let l=O(a.property.value,t,e,s,r);if(o){let d=[];for(let c of l.asyncValidators)d.push(F(c,1e3));a.asyncValidators.$reactive=d,a.syncValidators.$reactive=l.syncValidators}return r(l.syncResults),yield Promise.all(l.asyncPromises),i==a.validationIterationId&&(a.reactiveIsValid.value=n,a.validatingReactive.value=!1),a.reactiveIsValid.value})}function B(a,t,e,i){return p(this,null,function*(){var y,V;if(a.validation.$lazy==null)return!0;a.validatingLazy.value=!0;let s=!0,o=0,n=!0,u=a.validation.$lazy;(a.syncValidators.$lazy||a.asyncValidators.$lazy)&&(n=!1,u=((y=a.syncValidators.$lazy)!=null?y:[]).concat((V=a.asyncValidators.$lazy)!=null?V:[]));function r(d){let c;if(i==a.validationIterationId)for(let f=0;f<d.length;f++)d[f].isValid==!1&&(s=!1),d[f].identifier=`validator-lazy-${a.id}-${o++}`,c=a.lazyValidationResults.value.find(P=>P.identifier==d[f].identifier),c!=null?Object.assign(c,d[f]):a.lazyValidationResults.value.push(d[f])}let l=O(a.property.value,t,e,u,r);if(n){let d=[];for(let c of l.asyncValidators)d.push(F(c,500));a.asyncValidators.$lazy=d,a.syncValidators.$lazy=l.syncValidators}return r(l.syncResults),yield Promise.all(l.asyncPromises),i==a.validationIterationId&&(a.lazyIsValid.value=s,a.validatingLazy.value=!1),a.lazyIsValid.value})}function S(a,t,e,i,s){return p(this,null,function*(){let o=[];for(let n of a){let u=++n.validationIterationId;if(i&&o.push(k(n,t.value,e,u)),s&&o.push(B(n,t.value,e,u)),n.elementValidation!=null){let r=[];for(let l in n.arrayConfigMap)r.push(...n.arrayConfigMap[l].validationConfigs);o.push(S(r,t,e,i,s))}}return Promise.all(o).then(n=>n.every(u=>u==!0))})}function O(a,t,e,i=[],s){let o=[],n=[],u=[],r=[];for(let l of i){let y=l({value:a,parent:t,args:e});y instanceof Promise?(o.push(y.then(V=>V?s([V]):void 0)),r.push(l)):(n.push(y),u.push(l))}return{syncResults:n,asyncPromises:o,syncValidators:u,asyncValidators:r}}function $(a,t){var u,r,l,y;let e=t.$each!=null,i=b({isValid:m(()=>{var c,f;let V=(c=n.lazyIsValid.value)!=null?c:!1,d=(f=n.reactiveIsValid.value)!=null?f:!1;return V&&d}),isValidating:m(()=>n.validatingReactive.value||n.validatingLazy.value),isErrored:m(()=>i.validationResults.some(V=>V.isValid==!1)),errorMessages:m(()=>h(K(i.validationResults,V=>V.isValid?void 0:V.errorMessage))),validationResults:m(()=>{var V,d;return((V=n.reactiveValidationResults.value)!=null?V:[]).concat((d=n.lazyValidationResults.value)!=null?d:[])}),arrayState:m(()=>{if(Array.isArray(a.value)===!1)return;console.time("array state");let V=a.value,d=n.elementValidation,c=n.arrayConfigMap,f=(d==null?void 0:d.$reactive)!=null||(d==null?void 0:d.$lazy)!=null,P,R=[];for(let v=0;v<V.length;v++)if(V[v].$ffId===void 0&&Object.defineProperty(V[v],"$ffId",{value:`${n.id}-${n.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),P=V[v].$ffId,R.push(P),!c[P])if(f){let I=d,z=m(()=>V[v]),T=$(z,I);c[P]={validationConfigs:[T],validationState:T.validationState}}else{let I=V[v],T=G(I,d);c[P]={validationConfigs:T.validationConfigs,validationState:T.state}}let A=[];for(let v=0;v<R.length;v++)A.push(c[R[v]].validationState);return console.timeEnd("array state"),A})}),s=!(((r=(u=t.$lazy)==null?void 0:u.length)!=null?r:-1)>0),o=!(((y=(l=t.$reactive)==null?void 0:l.length)!=null?y:-1)>0),n={id:j.value++,validationIterationId:0,reactiveIsValid:g(o),reactiveValidationResults:g([]),validatingReactive:g(!1),lazyIsValid:g(s),lazyValidationResults:g([]),validatingLazy:g(!1),validation:t,syncValidators:{},asyncValidators:{},property:a,validationState:i,arrayConfigMap:{},hasElementValidation:e,elementId:0,elementValidation:t.$each};return n}function G(a,t){let e=[],i={};t!=null&&s(a,t);function s(o,n){var u,r;for(let l in n){let y=m(()=>o[l]),V=((u=n[l])==null?void 0:u.$reactive)!=null||((r=n[l])==null?void 0:r.$lazy)!=null;if(V){let d=n[l],c=$(y,d);e.push(c),i[l]=c.validationState}else if(V==!1){let d={},c=n[l];i[l]=d,s(y,c)}}}return{validationConfigs:e,state:i}}export{x as bufferAsync,q as isEmailSync,U as maximumLength,Z as minValue,Q as minimumLength,D as required,F as throttleQueueAsync,w as useValidation,J as validateIf};
