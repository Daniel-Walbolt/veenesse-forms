var A=(a,e,t)=>new Promise((n,o)=>{var r=i=>{try{V(t.next(i))}catch(l){o(l)}},d=i=>{try{V(t.throw(i))}catch(l){o(l)}},V=i=>i.done?n(i.value):Promise.resolve(i.value).then(r,d);V((t=t.apply(a,e)).next())});function O(a){let e=0,t;return(...n)=>{var r;let o=++e;return t=(r=t==null?void 0:t.then(()=>{if(e===o)return t=a(...n).then(d=>(t=void 0,d)),t}))!=null?r:a(...n).then(d=>(t=void 0,d)),t}}function $(a,e){let t=0,n;return(...o)=>new Promise(r=>{let d=++t,V=new Date().getTime();n!=null||(n=V-e);let i=V-n-e;i<0?new Promise(l=>setTimeout(l,-1*i)).then(()=>{n=new Date().getTime(),d===t&&r(a(...o)),r(void 0)}):(n=V,r(a(...o)))})}function M(a,e=t=>t){return a.reduce((t,n)=>{if(n!==void 0){let o=e(n);o!==void 0&&t.push(o)}return t},[])}function Y(){return a=>({isValid:a.value!==void 0&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function _(a,e){return t=>A(this,null,function*(){if((yield a(t))===!0)return e})}function aa(a){return e=>{var n;let t=String((n=e.value)!=null?n:"");return{isValid:t.length>=a,errorMessage:`Too short (${t.length} / ${a})`}}}function ea(a){return e=>{var n;let t=String((n=e.value)!=null?n:"");return{isValid:t.length<=a,errorMessage:`Too long (${t.length} / ${a})`}}}function ta(a){return e=>({isValid:e.value!==void 0&&e.value>=a,errorMessage:`The minimum value is ${a}`})}function ia(a){return e=>({isValid:e.value!==void 0&&e.value<=a,errorMessage:`The maximum value is ${a}`})}function na(a,e){return t=>({isValid:t.value===a(t),errorMessage:e})}function ra(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}import{ref as C,computed as x,watch as U,reactive as w}from"vue";import{computed as E}from"vue";import{computed as g,reactive as k,ref as b}from"vue";function L(){return`${Date.now()}-${Math.floor(Math.random()*1e3)}`}function G(a,e,t){let n=[],o=r=>`${e?"reactive":"lazy"}-${L()}`;t!=null&&(o=r=>`${t}-${r}`);for(let[r,d]of a.entries())n.push({validatorId:o(r),validator:d,optimized:!1,isReactive:e,previouslyReturnedValidators:!1,previouslySpawnedValidators:{},spawnedValidators:{}});return n}function S(a,e,t=[]){var l,y,u,s;let n=k({isValid:g(()=>{var P,f;let c=(P=i.isLazyValid.value)!=null?P:!1,v=(f=i.isReactiveValid.value)!=null?f:!1;return c&&v}),isValidating:g(()=>i.isValidatingReactive.value||i.isValidatingLazy.value),isErrored:g(()=>n.resultsArray.some(c=>c.isValid===!1)),errorMessages:g(()=>M(n.resultsArray,c=>c.isValid?void 0:c.errorMessage)),results:g(()=>i.namedValidationResults.value),resultsArray:g(()=>i.validationResults.value),arrayState:g(()=>{if(Array.isArray(a.value)===!1||i.elementValidation===void 0)return[];console.time("Array state");let c=a.value,v=i.elementValidation,P=i.arrayConfigMap,f=[],R={},m,I=[];for(let p=0;p<c.length;p++){if(c[p]!==void 0&&typeof c[p]=="object"?(c[p].$ffId===void 0&&Object.defineProperty(c[p],"$ffId",{value:`${i.id}-${i.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),m=c[p].$ffId):c[p]!==void 0&&(m=p),I.push(m),P[m]){f.push(P[m].validationState),R[m]=P[m];continue}if(h(v)){let F=g(()=>c[p]),K=S(F,v,i.arrayParents);P[m]={validationConfigs:[K],validationState:K.validationState}}else{let F=c[p],K=z(F,v,i.arrayParents.concat(F));P[m]={validationConfigs:K.validationConfigs,validationState:K.state}}f.push(P[m].validationState),R[m]=P[m]}return i.arrayConfigMap=R,console.timeEnd("Array state"),f})}),o=!(((y=(l=e.$lazy)==null?void 0:l.length)!=null?y:-1)>0),r=!(((s=(u=e.$reactive)==null?void 0:u.length)!=null?s:-1)>0),d=e.$reactive?G(e.$reactive,!0):[],V=e.$lazy?G(e.$lazy,!1):[],i={id:L(),validationIterationId:0,isReactiveValid:b(r),isValidatingReactive:b(!1),reactiveProcessedValidators:d,isLazyValid:b(o),isValidatingLazy:b(!1),lazyProcessedValidators:V,property:a,validation:e,validationState:n,validationResults:b([]),namedValidationResults:b({}),arrayConfigMap:{},elementId:0,elementValidation:e.$each,arrayParents:k(t)};return i}function z(a,e,t=[]){let n=[],o={};e!==void 0&&r(a,e);function r(d,V){for(let i in V){let l=g(()=>d[i]);if(h(V[i])){let y=V[i],u=S(l,y,t);n.push(u),o[i]=u.validationState}else{let y={},u=V[i];o[i]=y,r(l,u)}}}return{validationConfigs:n,state:o}}function h(a){return(a==null?void 0:a.$reactive)!==void 0||(a==null?void 0:a.$lazy)!==void 0||(a==null?void 0:a.$each)!==void 0}var j=500;function N(a,e,t,n,o){return A(this,null,function*(){let r=!0,d=(l,y,u)=>{if(n!==l.validationIterationId)return;u.isValid===!1&&(r=!1),u.id=y.validatorId;let s=l.validationResults.value.find(c=>c.id===u.id);s!==void 0?(Object.assign(s,u),u.name!==void 0&&l.namedValidationResults[u.name]!==void 0&&Object.assign(l.namedValidationResults.value[u.name],u)):(l.validationResults.value.push(u),u.name!==void 0&&(l.namedValidationResults.value[u.name]=u))},{asyncPromises:V,validatorsWhichPreviouslyReturnedValidators:i}=B(a,e,t,n,o,d,!0,1);if(yield Promise.all(V),n===a.validationIterationId){for(let l of i)for(let y of Object.keys(l.previouslySpawnedValidators))if(l.spawnedValidators[y]==null){let u=a.validationResults.value.findIndex(s=>s.id===y);u!==-1&&a.validationResults.value.splice(u)}}return r})}function B(a,e,t,n,o,r,d,V){let i=a.property.value,l=[],y=[],u=[];for(let s of o){let c=!1;s.previouslyReturnedValidators&&(s.previouslySpawnedValidators=s.spawnedValidators,s.spawnedValidators={},c=!0),s.previouslyReturnedValidators=!1;let v;if(s.computedValidator===void 0){let P={value:i,parent:e,args:t,arrayParents:a.arrayParents};v=s.validator(P)}else v=s.computedValidator.value;if(v instanceof Promise){let P=Date.now();l.push(v.then(f=>A(this,null,function*(){if(f===void 0){c&&u.push(s);return}let R=Date.now()-P;if(d&&R>j&&s.optimized===!1&&(s.optimized=!0,R<2*j?s.validator=$(s.validator,j):s.validator=O(s.validator)),Array.isArray(f)){let{asyncPromises:m,syncResults:I}=D(a,e,t,n,r,s,f,V);y.push(...I),yield Promise.all(m);return}else c&&u.push(s);r(a,s,f)})))}else if(Array.isArray(v)){let{asyncPromises:P,syncResults:f}=D(a,e,t,n,r,s,v,V);l.push(...P),y.push(...f)}else if(c&&u.push(s),v!==void 0){if(d&&s.optimized===!1){let P=s.validator;s.computedValidator=E(()=>{let f={value:a.property.value,parent:e,args:t,arrayParents:a.arrayParents};return P(f)}),s.optimized=!0,s.validator=()=>s.computedValidator.value}y.push(v),r(a,s,v)}}return{asyncPromises:l,syncResults:y,validatorsWhichPreviouslyReturnedValidators:u}}function D(a,e,t,n,o,r,d,V){let i=G(d,r.isReactive,r.validatorId),l=B(a,e,t,n,i,o,!1,++V),y={};for(let u of i)y[u.validatorId]=u;return r.spawnedValidators=y,r.previouslyReturnedValidators=!0,l}function J(a,e,t,n){return A(this,null,function*(){a.isValidatingReactive.value=!0;let o=yield N(a,e,t,n,a.reactiveProcessedValidators);return n===a.validationIterationId&&(a.isReactiveValid.value=o,a.isValidatingReactive.value=!1),a.isReactiveValid.value})}function Q(a,e,t,n){return A(this,null,function*(){a.isValidatingLazy.value=!0;let o=a.lazyProcessedValidators,r=yield N(a,e,t,n,o);return n===a.validationIterationId&&(a.isLazyValid.value=r,a.isValidatingLazy.value=!1),a.isLazyValid.value})}function T(a,e,t,n,o){return A(this,null,function*(){let r=[];for(let d of a){let V=++d.validationIterationId;if(n&&d.validation.$reactive!==void 0&&r.push(yield J(d,e.value,t,V)),o&&d.validation.$lazy!==void 0&&r.push(yield Q(d,e.value,t,V)),d.elementValidation!==void 0){let i=[];for(let l in d.arrayConfigMap)i.push(...d.arrayConfigMap[l].validationConfigs);r.push(yield T(i,e,t,n,o))}}return Promise.all(r).then(d=>d.every(V=>V===!0))})}function Z(a){var P;(P=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:e,validation:t,delayReactiveValidation:n,args:o}=a,r=C(!1),d=x(()=>i.some(f=>f.validationState.isValidating)),V=x(()=>i.every(R=>R.isReactiveValid.value&&R.isLazyValid.value)),i=[],l=w({}),y=C(JSON.stringify(a.objectToValidate.value)),u=x(()=>y.value!==JSON.stringify(a.objectToValidate.value));if(h(t)){let m=S(e,t);l=w(m.validationState),i=[m]}else{let f=e,R=t,m=z(f.value,R);l=w(m.state),i=m.validationConfigs}U(a.objectToValidate,()=>{n?r.value===!0&&T(i,e,o,!0,!1):T(i,e,o,!0,!1)},{deep:!0});function c(){return A(this,null,function*(){let f=yield T(i,e,o,!0,!0);return r.value=!0,f})}function v(f){y.value=JSON.stringify(f)}return w({hasValidated:r,validate:c,isValidating:d,propertyState:x(()=>l),isValid:V,setReference:v,isDirty:u})}export{O as bufferAsync,ra as isEmailSync,ea as maxLength,ia as maxNumber,aa as minLength,ta as minNumber,na as mustEqual,Y as required,$ as throttleQueueAsync,Z as useValidation,_ as validateIf};
