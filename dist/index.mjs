var p=(a,t,e)=>new Promise((n,s)=>{var o=l=>{try{V(e.next(l))}catch(u){s(u)}},i=l=>{try{V(e.throw(l))}catch(u){s(u)}},V=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,i);V((e=e.apply(a,t)).next())});function x(a){let t=0,e;return(...n)=>{var o;let s=++t;return e=(o=e==null?void 0:e.then(()=>{if(t==s)return e=a(...n).then(i=>(e=void 0,i)),e}))!=null?o:a(...n).then(i=>(e=void 0,i)),e}}function b(a,t){let e=0,n;return(...s)=>new Promise(o=>{let i=++e,V=new Date().getTime();n!=null||(n=V-t);let l=V-n-t;l<0?new Promise(u=>setTimeout(u,-1*l)).then(()=>{n=new Date().getTime(),i==e&&o(a(...s)),o(void 0)}):(n=V,o(a(...s)))})}function z(a,t=e=>e){return a.reduce((e,n)=>{if(n!=null){let s=t(n);s!=null&&e.push(s)}return e},[])}function O(a){return a.reduce((t,e)=>{if(e!=null)if(e instanceof Array)for(let n of e)n!=null&&t.push(n);else t.push(e);return t},[])}function E(){return a=>({isValid:a.value!=null&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function D(a,t){return e=>p(this,null,function*(){return a(e)==!1?{isValid:!0}:t})}function J(a){return t=>{var n;let e=String((n=t.value)!=null?n:"");return{isValid:e.length>=a,errorMessage:`Too short (${e.length} / ${a})`}}}function Q(a){return t=>{var e,n,s,o;return{isValid:((n=(e=t.value)==null?void 0:e.length)!=null?n:0)<=a,errorMessage:`Too long (${(o=(s=t.value)==null?void 0:s.length)!=null?o:0} / ${a})`}}}function U(a){return t=>({isValid:t.value!=null&&t.value>=a,errorMessage:`Must be atleast ${a}`})}function Z(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}import{ref as A,computed as m,watch as j,reactive as F}from"vue";var w=A(0);function M(a){var R;(R=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:t,validation:e,delayReactiveValidation:n,args:s}=a,o=A(!1),i=m(()=>l.some(P=>P.validationState.isValidating)),V=m(()=>l.every(g=>g.reactiveIsValid.value&&g.lazyIsValid.value)),l=[],u=F({}),f=A(JSON.stringify(a.objectToValidate.value)),d=m(()=>f.value!==JSON.stringify(a.objectToValidate.value));if((e==null?void 0:e.$reactive)!=null||(e==null?void 0:e.$lazy)!=null||(e==null?void 0:e.$each)!=null){let v=I(t,e);u=F(v.validationState),l=[v]}else{let P=t,g=e,v=G(P.value,g);u=F(v.state),l=v.validationConfigs}j(a.objectToValidate,()=>{n?o.value==!0&&K(l,t,s,!0,!1):K(l,t,s,!0,!1)},{deep:!0});function y(){return p(this,null,function*(){let P=yield K(l,t,s,!0,!0);return o.value=!0,P})}function c(P){f.value=JSON.stringify(P)}return F({hasValidated:o,validate:y,isValidating:i,propertyState:u,isValid:V,setReference:c,isDirty:d})}function k(a,t,e,n){return p(this,null,function*(){var f,d;if(a.validation.$reactive==null)return!0;a.validatingReactive.value=!0;let s=!0,o=!0,i=0,V=a.validation.$reactive;(a.syncValidators.$reactive||a.asyncValidators.$reactive)&&(s=!1,V=((f=a.syncValidators.$reactive)!=null?f:[]).concat((d=a.asyncValidators.$reactive)!=null?d:[]));function l(r){let y;if(n==a.validationIterationId)for(let c=0;c<r.length;c++)r[c].isValid==!1&&(o=!1),r[c].identifier=`validator-reactive-${a.id}-${i++}`,y=a.reactiveValidationResults.value.find(R=>R.identifier==r[c].identifier),y!=null?Object.assign(y,r[c]):a.reactiveValidationResults.value.push(r[c])}let u=h(a.property.value,t,e,V,l);if(s){let r=[];for(let y of u.asyncValidators)r.push(b(y,1e3));a.asyncValidators.$reactive=r,a.syncValidators.$reactive=u.syncValidators}return l(u.syncResults),yield Promise.all(u.asyncPromises),n==a.validationIterationId&&(a.reactiveIsValid.value=o,a.validatingReactive.value=!1),a.reactiveIsValid.value})}function B(a,t,e,n){return p(this,null,function*(){var f,d;if(a.validation.$lazy==null)return!0;a.validatingLazy.value=!0;let s=!0,o=0,i=!0,V=a.validation.$lazy;(a.syncValidators.$lazy||a.asyncValidators.$lazy)&&(i=!1,V=((f=a.syncValidators.$lazy)!=null?f:[]).concat((d=a.asyncValidators.$lazy)!=null?d:[]));function l(r){let y;if(n==a.validationIterationId)for(let c=0;c<r.length;c++)r[c].isValid==!1&&(s=!1),r[c].identifier=`validator-lazy-${a.id}-${o++}`,y=a.lazyValidationResults.value.find(R=>R.identifier==r[c].identifier),y!=null?Object.assign(y,r[c]):a.lazyValidationResults.value.push(r[c])}let u=h(a.property.value,t,e,V,l);if(i){let r=[];for(let y of u.asyncValidators)r.push(b(y,500));a.asyncValidators.$lazy=r,a.syncValidators.$lazy=u.syncValidators}return l(u.syncResults),yield Promise.all(u.asyncPromises),n==a.validationIterationId&&(a.lazyIsValid.value=s,a.validatingLazy.value=!1),a.lazyIsValid.value})}function K(a,t,e,n,s){return p(this,null,function*(){let o=[];for(let i of a){let V=++i.validationIterationId;if(n&&o.push(k(i,t.value,e,V)),s&&o.push(B(i,t.value,e,V)),i.elementValidation!=null){let l=[];for(let u in i.arrayConfigMap)l.push(...i.arrayConfigMap[u].validationConfigs);o.push(K(l,t,e,n,s))}}return Promise.all(o).then(i=>i.every(V=>V==!0))})}function h(a,t,e,n=[],s){let o=[],i=[],V=[],l=[];function u(f){let d=f,{syncResults:r,syncValidators:y,asyncPromises:c,asyncValidators:R}=h(a,t,e,d,s);i.push(...r),o.push(...c)}for(let f of n){let d=f({value:a,parent:t,args:e});d instanceof Promise?(o.push(d.then(r=>{if(r!==void 0){if(Array.isArray(r)){u(r);return}return s([r])}})),l.push(f)):Array.isArray(d)?u(d):(d!==void 0&&i.push(d),V.push(f))}return{syncResults:i,asyncPromises:o,syncValidators:V,asyncValidators:l}}function I(a,t){var V,l,u,f;let e=t.$each!=null,n=F({isValid:m(()=>{var y,c;let d=(y=i.lazyIsValid.value)!=null?y:!1,r=(c=i.reactiveIsValid.value)!=null?c:!1;return d&&r}),isValidating:m(()=>i.validatingReactive.value||i.validatingLazy.value),isErrored:m(()=>n.validationResults.some(d=>d.isValid==!1)),errorMessages:m(()=>O(z(n.validationResults,d=>d.isValid?void 0:d.errorMessage))),validationResults:m(()=>{var d,r;return((d=i.reactiveValidationResults.value)!=null?d:[]).concat((r=i.lazyValidationResults.value)!=null?r:[])}),arrayState:m(()=>{if(Array.isArray(a.value)===!1)return;console.time("array state");let d=a.value,r=i.elementValidation,y=i.arrayConfigMap,c=(r==null?void 0:r.$reactive)!=null||(r==null?void 0:r.$lazy)!=null,R,P=[];for(let v=0;v<d.length;v++)if(d[v].$ffId===void 0&&Object.defineProperty(d[v],"$ffId",{value:`${i.id}-${i.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),R=d[v].$ffId,P.push(R),!y[R])if(c){let S=r,$=m(()=>d[v]),T=I($,S);y[R]={validationConfigs:[T],validationState:T.validationState}}else{let S=d[v],T=G(S,r);y[R]={validationConfigs:T.validationConfigs,validationState:T.state}}let g=[];for(let v=0;v<P.length;v++)g.push(y[P[v]].validationState);return console.timeEnd("array state"),g})}),s=!(((l=(V=t.$lazy)==null?void 0:V.length)!=null?l:-1)>0),o=!(((f=(u=t.$reactive)==null?void 0:u.length)!=null?f:-1)>0),i={id:w.value++,validationIterationId:0,reactiveIsValid:A(o),reactiveValidationResults:A([]),validatingReactive:A(!1),lazyIsValid:A(s),lazyValidationResults:A([]),validatingLazy:A(!1),validation:t,syncValidators:{},asyncValidators:{},property:a,validationState:n,arrayConfigMap:{},hasElementValidation:e,elementId:0,elementValidation:t.$each};return i}function G(a,t){let e=[],n={};console.log("Performing complex validation setup",t),t!=null&&s(a,t);function s(o,i){var V,l,u;for(let f in i){let d=m(()=>o[f]),r=((V=i[f])==null?void 0:V.$reactive)!=null||((l=i[f])==null?void 0:l.$lazy)!=null||((u=i[f])==null?void 0:u.$each)!=null;if(r){let y=i[f],c=I(d,y);e.push(c),n[f]=c.validationState}else if(r==!1){let y={},c=i[f];n[f]=y,s(d,c)}}}return{validationConfigs:e,state:n}}export{x as bufferAsync,Z as isEmailSync,Q as maximumLength,U as minValue,J as minimumLength,E as required,b as throttleQueueAsync,M as useValidation,D as validateIf};
