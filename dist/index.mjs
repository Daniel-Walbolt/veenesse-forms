var A=(a,t,e)=>new Promise((i,o)=>{var r=n=>{try{c(e.next(n))}catch(d){o(d)}},u=n=>{try{c(e.throw(n))}catch(d){o(d)}},c=n=>n.done?i(n.value):Promise.resolve(n.value).then(r,u);c((e=e.apply(a,t)).next())});function I(a){let t=0,e;return(...i)=>{var r;let o=++t;return e=(r=e==null?void 0:e.then(()=>{if(t==o)return e=a(...i).then(u=>(e=void 0,u)),e}))!=null?r:a(...i).then(u=>(e=void 0,u)),e}}function O(a,t){let e=0,i;return(...o)=>new Promise(r=>{let u=++e,c=new Date().getTime();i!=null||(i=c-t);let n=c-i-t;n<0?new Promise(d=>setTimeout(d,-1*n)).then(()=>{i=new Date().getTime(),u==e&&r(a(...o)),r(void 0)}):(i=c,r(a(...o)))})}function k(a,t=e=>e){return a.reduce((e,i)=>{if(i!==void 0){let o=t(i);o!==void 0&&e.push(o)}return e},[])}function L(a){return a.reduce((t,e)=>{if(e!==void 0)if(e instanceof Array)for(let i of e)i!==void 0&&t.push(i);else t.push(e);return t},[])}function _(){return a=>({isValid:a.value!=null&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function aa(a,t){return e=>A(this,null,function*(){return a(e)==!1?{isValid:!0}:t})}function ea(a){return t=>{var i;let e=String((i=t.value)!=null?i:"");return{isValid:e.length>=a,errorMessage:`Too short (${e.length} / ${a})`}}}function ta(a){return t=>{var e,i,o,r;return{isValid:((i=(e=t.value)==null?void 0:e.length)!=null?i:0)<=a,errorMessage:`Too long (${(r=(o=t.value)==null?void 0:o.length)!=null?r:0} / ${a})`}}}function ia(a){return t=>({isValid:t.value!=null&&t.value>=a,errorMessage:`Must be atleast ${a}`})}function na(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}import{ref as q,computed as h,watch as W,reactive as S}from"vue";import{computed as E}from"vue";import{computed as g,reactive as N,ref as b}from"vue";function C(){return`${Date.now()}-${Math.floor(Math.random()*1e3)}`}function T(a,t,e){let i=[],o=r=>`${t?"reactive":"lazy"}-${C()}`;e!=null&&(o=r=>`${e}-${r}`);for(let[r,u]of a.entries())i.push({validatorId:o(r),validator:u,optimized:!1,isReactive:t,previouslyReturnedValidators:!1,previouslySpawnedValidators:{},spawnedValidators:{}});return i}function G(a,t,e=[]){var d,f,l,s;let i=N({isValid:g(()=>{var P,V;let y=(P=n.isLazyValid.value)!=null?P:!1,m=(V=n.isReactiveValid.value)!=null?V:!1;return y&&m}),isValidating:g(()=>n.isValidatingReactive.value||n.isValidatingLazy.value),isErrored:g(()=>i.resultsArray.some(y=>y.isValid==!1)),errorMessages:g(()=>L(k(i.resultsArray,y=>y.isValid?void 0:y.errorMessage))),results:g(()=>n.namedValidationResults.value),resultsArray:g(()=>n.validationResults.value),arrayState:g(()=>{if(Array.isArray(a.value)===!1||n.elementValidation===void 0)return[];let y=a.value,m=n.elementValidation,P=n.arrayConfigMap,V,v=[];for(let R=0;R<y.length;R++){if(y[R].$ffId===void 0&&Object.defineProperty(y[R],"$ffId",{value:`${n.id}-${n.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),V=y[R].$ffId,v.push(V),P[V])continue;let x=g(()=>y[R]);if(D(m)){let w=G(x,m,n.arrayParents.concat(x));P[V]={validationConfigs:[w],validationState:w.validationState}}else{let j=y[R],M=$(j,m,n.arrayParents.concat(x));P[V]={validationConfigs:M.validationConfigs,validationState:M.state}}}let p=[],K={};for(let R of v)p.push(P[R].validationState),K[R]=P[R];return n.arrayConfigMap=K,p})}),o=!(((f=(d=t.$lazy)==null?void 0:d.length)!=null?f:-1)>0),r=!(((s=(l=t.$reactive)==null?void 0:l.length)!=null?s:-1)>0),u=t.$reactive?T(t.$reactive,!0):[],c=t.$lazy?T(t.$lazy,!1):[],n={id:C(),validationIterationId:0,isReactiveValid:b(r),isValidatingReactive:b(!1),reactiveProcessedValidators:u,isLazyValid:b(o),isValidatingLazy:b(!1),lazyProcessedValidators:c,property:a,validation:t,validationState:i,validationResults:b([]),namedValidationResults:b({}),arrayConfigMap:{},elementId:0,elementValidation:t.$each,arrayParents:N(e)};return n}function $(a,t,e=[]){let i=[],o={};t!==void 0&&r(a,t);function r(u,c){for(let n in c){let d=g(()=>u[n]);if(D(c[n])){let f=c[n],l=G(d,f,e);i.push(l),o[n]=l.validationState}else{let f={},l=c[n];o[n]=f,r(d,l)}}}return{validationConfigs:i,state:o}}function D(a){return(a==null?void 0:a.$reactive)!==void 0||(a==null?void 0:a.$lazy)!==void 0||(a==null?void 0:a.$each)!==void 0}var z=500;function J(a,t,e,i,o){return A(this,null,function*(){let r=!0,u=(d,f,l)=>{if(i!==d.validationIterationId)return;l.isValid===!1&&(r=!1),l.id=f.validatorId;let s=d.validationResults.value.find(y=>y.id===l.id);s!==void 0?(Object.assign(s,l),l.name!==void 0&&d.namedValidationResults[l.name]!==void 0&&Object.assign(d.namedValidationResults.value[l.name],l)):(d.validationResults.value.push(l),l.name!==void 0&&(d.namedValidationResults.value[l.name]=l)),l.name&&console.log("Named results",d.namedValidationResults.value)},{asyncPromises:c,validatorsWhichPreviouslyReturnedValidators:n}=Q(a,t,e,i,o,u,!0,1);if(yield Promise.all(c),i===a.validationIterationId){for(let d of n)for(let f of Object.keys(d.previouslySpawnedValidators))if(d.spawnedValidators[f]==null){let l=a.validationResults.value.findIndex(s=>s.id===f);l!==-1&&a.validationResults.value.splice(l)}}return r})}function Q(a,t,e,i,o,r,u,c){let n=a.property.value,d=[],f=[],l=[];for(let s of o){let y=!1;s.previouslyReturnedValidators&&(s.previouslySpawnedValidators=s.spawnedValidators,s.spawnedValidators={},y=!0),s.previouslyReturnedValidators=!1;let m;if(s.computedValidator===void 0){let P={value:n,parent:t,args:e,arrayParents:a.arrayParents.map(V=>V.value)};m=s.validator(P)}else m=s.computedValidator.value;if(m instanceof Promise){let P=Date.now();d.push(m.then(V=>A(this,null,function*(){if(V===void 0){y&&l.push(s);return}let v=Date.now()-P;if(u&&v>z&&s.optimized===!1&&(s.optimized=!0,v<2*z?s.validator=O(s.validator,z):s.validator=I(s.validator)),Array.isArray(V)){let{asyncPromises:p,syncResults:K}=B(a,t,e,i,r,s,V,c);f.push(...K),yield Promise.all(p);return}else y&&l.push(s);r(a,s,V)})))}else if(Array.isArray(m)){let{asyncPromises:P,syncResults:V}=B(a,t,e,i,r,s,m,c);d.push(...P),f.push(...V)}else if(y&&l.push(s),m!==void 0){if(u&&s.optimized===!1){let P=s.validator;s.computedValidator=E(()=>{let V={value:a.property.value,parent:t,args:e,arrayParents:a.arrayParents.map(v=>v.value)};return P(V)}),s.optimized=!0,s.validator=()=>s.computedValidator.value}f.push(m),r(a,s,m)}}return{asyncPromises:d,syncResults:f,validatorsWhichPreviouslyReturnedValidators:l}}function B(a,t,e,i,o,r,u,c){let n=T(u,r.isReactive,r.validatorId),d=Q(a,t,e,i,n,o,!1,++c),f={};for(let l of n)f[l.validatorId]=l;return r.spawnedValidators=f,r.previouslyReturnedValidators=!0,d}function U(a,t,e,i){return A(this,null,function*(){a.isValidatingReactive.value=!0;let o=yield J(a,t,e,i,a.reactiveProcessedValidators);return i===a.validationIterationId&&(a.isReactiveValid.value=o,a.isValidatingReactive.value=!1),a.isReactiveValid.value})}function Z(a,t,e,i){return A(this,null,function*(){a.isValidatingLazy.value=!0;let o=a.lazyProcessedValidators,r=yield J(a,t,e,i,o);return i===a.validationIterationId&&(a.isLazyValid.value=r,a.isValidatingLazy.value=!1),a.isLazyValid.value})}function F(a,t,e,i,o){return A(this,null,function*(){let r=[];for(let u of a){let c=++u.validationIterationId;if(i&&u.validation.$reactive!==void 0&&r.push(yield U(u,t.value,e,c)),o&&u.validation.$lazy!==void 0&&r.push(yield Z(u,t.value,e,c)),u.elementValidation!==void 0){let n=[];for(let d in u.arrayConfigMap)n.push(...u.arrayConfigMap[d].validationConfigs);r.push(yield F(n,t,e,i,o))}}return Promise.all(r).then(u=>u.every(c=>c===!0))})}function H(a){var P;(P=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:t,validation:e,delayReactiveValidation:i,args:o}=a,r=q(!1),u=h(()=>n.some(V=>V.validationState.isValidating)),c=h(()=>n.every(v=>v.isReactiveValid.value&&v.isLazyValid.value)),n=[],d=S({}),f=q(JSON.stringify(a.objectToValidate.value)),l=h(()=>f.value!==JSON.stringify(a.objectToValidate.value));if((e==null?void 0:e.$reactive)!=null||(e==null?void 0:e.$lazy)!=null||(e==null?void 0:e.$each)!=null){let p=G(t,e);d=S(p.validationState),n=[p]}else{let V=t,v=e,p=$(V.value,v);d=S(p.state),n=p.validationConfigs}W(a.objectToValidate,()=>{i?r.value==!0&&F(n,t,o,!0,!1):(console.time("Reactive validation"),F(n,t,o,!0,!1),console.timeEnd("Reactive validation"))},{deep:!0});function y(){return A(this,null,function*(){let V=yield F(n,t,o,!0,!0);return r.value=!0,V})}function m(V){f.value=JSON.stringify(V)}return S({hasValidated:r,validate:y,isValidating:u,propertyState:h(()=>d),isValid:c,setReference:m,isDirty:l})}export{I as bufferAsync,na as isEmailSync,ta as maximumLength,ia as minValue,ea as minimumLength,_ as required,O as throttleQueueAsync,H as useValidation,aa as validateIf};
