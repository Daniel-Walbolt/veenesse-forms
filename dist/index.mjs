var p=(a,t,e)=>new Promise((n,l)=>{var o=r=>{try{u(e.next(r))}catch(d){l(d)}},i=r=>{try{u(e.throw(r))}catch(d){l(d)}},u=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,i);u((e=e.apply(a,t)).next())});function G(a){let t=0,e;return(...n)=>{var o;let l=++t;return e=(o=e==null?void 0:e.then(()=>{if(t==l)return e=a(...n).then(i=>(e=void 0,i)),e}))!=null?o:a(...n).then(i=>(e=void 0,i)),e}}function F(a,t){let e=0,n;return(...l)=>new Promise(o=>{let i=++e,u=new Date().getTime();n!=null||(n=u-t);let r=u-n-t;r<0?new Promise(d=>setTimeout(d,-1*r)).then(()=>{n=new Date().getTime(),i==e&&o(a(...l)),o(void 0)}):(n=u,o(a(...l)))})}function K(a,t=e=>e){return a.reduce((e,n)=>{if(n!=null){let l=t(n);l!=null&&e.push(l)}return e},[])}function h(a){return a.reduce((t,e)=>{if(e!=null)if(e instanceof Array)for(let n of e)n!=null&&t.push(n);else t.push(e);return t},[])}function D(){return a=>({isValid:a.value!=null&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function J(a,t){return e=>p(this,null,function*(){if(a(e.parent,e.args)==!1)return{isValid:!0};let n=[],l=[];for(let r of t){let d=r(e);d instanceof Promise?n.push(d):l.push(d)}let o=yield Promise.all(n);l.push(...K(o));let i=l.filter(r=>!r.isValid).map(r=>r.errorMessage),u=h(i);return{isValid:l.every(r=>r.isValid==!0),errorMessage:u}})}function Q(a){return t=>{var n;let e=String((n=t.value)!=null?n:"");return{isValid:e.length>=a,errorMessage:`Too short (${e.length} / ${a})`}}}function U(a){return t=>{var e,n,l,o;return{isValid:((n=(e=t.value)==null?void 0:e.length)!=null?n:0)<=a,errorMessage:`Too long (${(o=(l=t.value)==null?void 0:l.length)!=null?o:0} / ${a})`}}}function Z(a){return t=>({isValid:t.value!=null&&t.value>=a,errorMessage:`Must be atleast ${a}`})}function q(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}import{ref as g,computed as m,watch as j,reactive as b}from"vue";var M=g(0);function w(a){var P;(P=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:t,validation:e,delayReactiveValidation:n,args:l}=a,o=g(!1),i=m(()=>r.some(R=>R.validationState.isValidating)),u=m(()=>r.every(A=>A.reactiveIsValid.value&&A.lazyIsValid.value)),r=[],d=b({}),y=g(JSON.stringify(a.objectToValidate.value)),V=m(()=>y.value!==JSON.stringify(a.objectToValidate.value));if((e==null?void 0:e.$reactive)!=null||(e==null?void 0:e.$lazy)!=null||(e==null?void 0:e.$each)!=null){let v=$(t,e);d=b(v.validationState),r=[v]}else{console.log("Complex object");let R=t,A=e,v=x(R.value,A);d=b(v.state),r=v.validationConfigs}j(a.objectToValidate,()=>{n?o.value==!0&&S(r,t,l,!0,!1):S(r,t,l,!0,!1)},{deep:!0});function f(){return p(this,null,function*(){let R=yield S(r,t,l,!0,!0);return o.value=!0,R})}function c(R){y.value=JSON.stringify(R)}return b({hasValidated:o,validate:f,isValidating:i,propertyState:d,isValid:u,setReference:c,isDirty:V})}function k(a,t,e,n){return p(this,null,function*(){var y,V;if(a.validation.$reactive==null)return!0;a.validatingReactive.value=!0;let l=a.validation.$reactive,o=!0;(a.syncValidators.$reactive||a.asyncValidators.$reactive)&&(o=!1,l=((y=a.syncValidators.$reactive)!=null?y:[]).concat((V=a.asyncValidators.$reactive)!=null?V:[]));let i=!0,u=0;function r(s){let f;if(n==a.validationIterationId)for(let c=0;c<s.length;c++)s[c].isValid==!1&&(i=!1),s[c].identifier=`validator-reactive-${a.id}-${u++}`,f=a.reactiveValidationResults.value.find(P=>P.identifier==s[c].identifier),f!=null?Object.assign(f,s[c]):a.reactiveValidationResults.value.push(s[c])}let d=O(a.property.value,t,e,l,r);if(o){let s=[];for(let f of d.asyncValidators)s.push(F(f,1e3));a.asyncValidators.$reactive=s,a.syncValidators.$reactive=d.syncValidators}return r(d.syncResults),yield Promise.all(d.asyncPromises),n==a.validationIterationId&&(a.reactiveIsValid.value=i,a.validatingReactive.value=!1),a.reactiveIsValid.value})}function B(a,t,e,n){return p(this,null,function*(){var y,V;if(a.validation.$lazy==null)return!0;a.validatingLazy.value=!0;let l=!0,o=0,i=!0,u=a.validation.$lazy;(a.syncValidators.$lazy||a.asyncValidators.$lazy)&&(i=!1,u=((y=a.syncValidators.$lazy)!=null?y:[]).concat((V=a.asyncValidators.$lazy)!=null?V:[]));function r(s){let f;if(n==a.validationIterationId)for(let c=0;c<s.length;c++)s[c].isValid==!1&&(l=!1),s[c].identifier=`validator-lazy-${a.id}-${o++}`,f=a.lazyValidationResults.value.find(P=>P.identifier==s[c].identifier),f!=null?Object.assign(f,s[c]):a.lazyValidationResults.value.push(s[c])}let d=O(a.property.value,t,e,u,r);if(i){let s=[];for(let f of d.asyncValidators)s.push(F(f,500));a.asyncValidators.$lazy=s,a.syncValidators.$lazy=d.syncValidators}return r(d.syncResults),yield Promise.all(d.asyncPromises),n==a.validationIterationId&&(a.lazyIsValid.value=l,a.validatingLazy.value=!1),a.lazyIsValid.value})}function S(a,t,e,n,l){return p(this,null,function*(){let o=[];for(let i of a){let u=++i.validationIterationId;if(n&&o.push(k(i,t.value,e,u)),l&&o.push(B(i,t.value,e,u)),i.elementValidation!=null){let r=[];for(let d in i.arrayConfigMap)r.push(...i.arrayConfigMap[d].validationConfigs);o.push(S(r,t,e,n,l))}}return Promise.all(o).then(i=>i.every(u=>u==!0))})}function O(a,t,e,n=[],l){let o=[],i=[],u=[],r=[];for(let d of n){let y=d({value:a,parent:t,args:e});y instanceof Promise?(o.push(y.then(V=>V?l([V]):void 0)),r.push(d)):(i.push(y),u.push(d))}return{syncResults:i,asyncPromises:o,syncValidators:u,asyncValidators:r}}function $(a,t){var u,r,d,y;let e=t.$each!=null,n=b({isValid:m(()=>{var f,c;let V=(f=i.lazyIsValid.value)!=null?f:!1,s=(c=i.reactiveIsValid.value)!=null?c:!1;return V&&s}),isValidating:m(()=>i.validatingReactive.value||i.validatingLazy.value),isErrored:m(()=>n.validationResults.some(V=>V.isValid==!1)),errorMessages:m(()=>h(K(n.validationResults,V=>V.isValid?void 0:V.errorMessage))),validationResults:m(()=>{var V,s;return((V=i.reactiveValidationResults.value)!=null?V:[]).concat((s=i.lazyValidationResults.value)!=null?s:[])}),arrayState:m(()=>{if(Array.isArray(a.value)===!1)return;console.time("array state");let V=a.value,s=i.elementValidation,f=i.arrayConfigMap,c=(s==null?void 0:s.$reactive)!=null||(s==null?void 0:s.$lazy)!=null,P,R=[];for(let v=0;v<V.length;v++)if(V[v].$ffId===void 0&&Object.defineProperty(V[v],"$ffId",{value:`${i.id}-${i.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),P=V[v].$ffId,R.push(P),!f[P])if(c){let I=s,z=m(()=>V[v]),T=$(z,I);f[P]={validationConfigs:[T],validationState:T.validationState}}else{let I=V[v],T=x(I,s);f[P]={validationConfigs:T.validationConfigs,validationState:T.state}}let A=[];for(let v=0;v<R.length;v++)A.push(f[R[v]].validationState);return console.timeEnd("array state"),A})}),l=!(((r=(u=t.$lazy)==null?void 0:u.length)!=null?r:-1)>0),o=!(((y=(d=t.$reactive)==null?void 0:d.length)!=null?y:-1)>0),i={id:M.value++,validationIterationId:0,reactiveIsValid:g(o),reactiveValidationResults:g([]),validatingReactive:g(!1),lazyIsValid:g(l),lazyValidationResults:g([]),validatingLazy:g(!1),validation:t,syncValidators:{},asyncValidators:{},property:a,validationState:n,arrayConfigMap:{},hasElementValidation:e,elementId:0,elementValidation:t.$each};return i}function x(a,t){let e=[],n={};console.log("Performing complex validation setup",t),t!=null&&l(a,t);function l(o,i){var u,r,d;for(let y in i){let V=m(()=>o[y]),s=((u=i[y])==null?void 0:u.$reactive)!=null||((r=i[y])==null?void 0:r.$lazy)!=null||((d=i[y])==null?void 0:d.$each)!=null;if(s){let f=i[y],c=$(V,f);e.push(c),n[y]=c.validationState}else if(s==!1){let f={},c=i[y];n[y]=f,l(V,c)}}}return{validationConfigs:e,state:n}}export{G as bufferAsync,q as isEmailSync,U as maximumLength,Z as minValue,Q as minimumLength,D as required,F as throttleQueueAsync,w as useValidation,J as validateIf};
