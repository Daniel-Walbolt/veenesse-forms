var p=(a,i,e)=>new Promise((n,l)=>{var d=r=>{try{u(e.next(r))}catch(s){l(s)}},t=r=>{try{u(e.throw(r))}catch(s){l(s)}},u=r=>r.done?n(r.value):Promise.resolve(r.value).then(d,t);u((e=e.apply(a,i)).next())});function G(a){let i=0,e;return(...n)=>{var d;let l=++i;return e=(d=e==null?void 0:e.then(()=>{if(i==l)return e=a(...n).then(t=>(e=void 0,t)),e}))!=null?d:a(...n).then(t=>(e=void 0,t)),e}}function F(a,i){let e=0,n;return(...l)=>new Promise(d=>{let t=++e,u=new Date().getTime();n!=null||(n=u-i);let r=u-n-i;r<0?new Promise(s=>setTimeout(s,-1*r)).then(()=>{n=new Date().getTime(),t==e&&d(a(...l)),d(void 0)}):(n=u,d(a(...l)))})}function K(a,i=e=>e){return a.reduce((e,n)=>{if(n!=null){let l=i(n);l!=null&&e.push(l)}return e},[])}function h(a){return a.reduce((i,e)=>{if(e!=null)if(e instanceof Array)for(let n of e)n!=null&&i.push(n);else i.push(e);return i},[])}function D(){return a=>({isValid:a.value!=null&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function J(a,i){return e=>p(this,null,function*(){if(a(e.parent,e.args)==!1)return{isValid:!0};let n=[],l=[];for(let r of i){let s=r(e);s instanceof Promise?n.push(s):l.push(s)}let d=yield Promise.all(n);l.push(...K(d));let t=l.filter(r=>!r.isValid).map(r=>r.errorMessage),u=h(t);return{isValid:l.every(r=>r.isValid==!0),errorMessage:u}})}function Q(a){return i=>{var n;let e=String((n=i.value)!=null?n:"");return{isValid:e.length>=a,errorMessage:`Too short (${e.length} / ${a})`}}}function U(a){return i=>{var e,n,l,d;return{isValid:((n=(e=i.value)==null?void 0:e.length)!=null?n:0)<=a,errorMessage:`Too long (${(d=(l=i.value)==null?void 0:l.length)!=null?d:0} / ${a})`}}}function Z(a){return i=>({isValid:i.value!=null&&i.value>=a,errorMessage:`Must be atleast ${a}`})}function q(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}import{ref as g,computed as m,watch as j,reactive as b}from"vue";var M=g(0);function w(a){var P;(P=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:i,validation:e,delayReactiveValidation:n,args:l}=a,d=g(!1),t=m(()=>r.some(R=>R.validationState.isValidating)),u=m(()=>r.every(A=>A.reactiveIsValid.value&&A.lazyIsValid.value)),r=[],s=b({}),y=g(JSON.stringify(a.objectToValidate.value)),V=m(()=>y.value!==JSON.stringify(a.objectToValidate.value));if((e==null?void 0:e.$reactive)!=null||(e==null?void 0:e.$lazy)!=null||(e==null?void 0:e.$each)!=null){let v=$(i,e);s=b(v.validationState),r=[v]}else{console.log("Complex object");let R=i,A=e,v=x(R.value,A);s=b(v.state),r=v.validationConfigs}j(a.objectToValidate,()=>{n?d.value==!0&&S(r,i,l,!0,!1):S(r,i,l,!0,!1)},{deep:!0});function f(){return p(this,null,function*(){let R=yield S(r,i,l,!0,!0);return d.value=!0,R})}function c(R){y.value=JSON.stringify(R)}return b({hasValidated:d,validate:f,isValidating:t,propertyState:s,isValid:u,setReference:c,isDirty:V})}function k(a,i,e,n){return p(this,null,function*(){var y,V;if(a.validation.$reactive==null)return!0;a.validatingReactive.value=!0;let l=a.validation.$reactive,d=!0;(a.syncValidators.$reactive||a.asyncValidators.$reactive)&&(d=!1,l=((y=a.syncValidators.$reactive)!=null?y:[]).concat((V=a.asyncValidators.$reactive)!=null?V:[]));let t=!0,u=0;function r(o){let f;if(n==a.validationIterationId)for(let c=0;c<o.length;c++)o[c].isValid==!1&&(t=!1),o[c].identifier=`validator-reactive-${a.id}-${u++}`,f=a.reactiveValidationResults.value.find(P=>P.identifier==o[c].identifier),f!=null?Object.assign(f,o[c]):a.reactiveValidationResults.value.push(o[c])}let s=O(a.property.value,i,e,l,r);if(d){let o=[];for(let f of s.asyncValidators)o.push(F(f,1e3));a.asyncValidators.$reactive=o,a.syncValidators.$reactive=s.syncValidators}return r(s.syncResults),yield Promise.all(s.asyncPromises),n==a.validationIterationId&&(a.reactiveIsValid.value=t,a.validatingReactive.value=!1),a.reactiveIsValid.value})}function B(a,i,e,n){return p(this,null,function*(){var y,V;if(a.validation.$lazy==null)return!0;a.validatingLazy.value=!0;let l=!0,d=0,t=!0,u=a.validation.$lazy;(a.syncValidators.$lazy||a.asyncValidators.$lazy)&&(t=!1,u=((y=a.syncValidators.$lazy)!=null?y:[]).concat((V=a.asyncValidators.$lazy)!=null?V:[]));function r(o){let f;if(n==a.validationIterationId)for(let c=0;c<o.length;c++)o[c].isValid==!1&&(l=!1),o[c].identifier=`validator-lazy-${a.id}-${d++}`,f=a.lazyValidationResults.value.find(P=>P.identifier==o[c].identifier),f!=null?Object.assign(f,o[c]):a.lazyValidationResults.value.push(o[c])}let s=O(a.property.value,i,e,u,r);if(t){let o=[];for(let f of s.asyncValidators)o.push(F(f,500));a.asyncValidators.$lazy=o,a.syncValidators.$lazy=s.syncValidators}return r(s.syncResults),yield Promise.all(s.asyncPromises),n==a.validationIterationId&&(a.lazyIsValid.value=l,a.validatingLazy.value=!1),a.lazyIsValid.value})}function S(a,i,e,n,l){return p(this,null,function*(){let d=[];for(let t of a){let u=++t.validationIterationId;if(n&&d.push(k(t,i.value,e,u)),l&&d.push(B(t,i.value,e,u)),t.elementValidation!=null){let r=[];for(let s in t.arrayConfigMap)r.push(...t.arrayConfigMap[s].validationConfigs);d.push(S(r,i,e,n,l))}}return Promise.all(d).then(t=>t.every(u=>u==!0))})}function O(a,i,e,n=[],l){let d=[],t=[],u=[],r=[];for(let s of n){let y=s({value:a,parent:i,args:e});y instanceof Promise?(d.push(y.then(V=>V?l([V]):void 0)),r.push(s)):(t.push(y),u.push(s))}return{syncResults:t,asyncPromises:d,syncValidators:u,asyncValidators:r}}function $(a,i){var u,r,s,y;let e=i.$each!=null,n=b({isValid:m(()=>{var f,c;let V=(f=t.lazyIsValid.value)!=null?f:!1,o=(c=t.reactiveIsValid.value)!=null?c:!1;return V&&o}),isValidating:m(()=>t.validatingReactive.value||t.validatingLazy.value),isErrored:m(()=>n.validationResults.some(V=>V.isValid==!1)),errorMessages:m(()=>h(K(n.validationResults,V=>V.isValid?void 0:V.errorMessage))),validationResults:m(()=>{var V,o;return((V=t.reactiveValidationResults.value)!=null?V:[]).concat((o=t.lazyValidationResults.value)!=null?o:[])}),arrayState:m(()=>{if(Array.isArray(a.value)===!1)return;console.time("array state");let V=a.value,o=t.elementValidation,f=t.arrayConfigMap,c=(o==null?void 0:o.$reactive)!=null||(o==null?void 0:o.$lazy)!=null,P,R=[];for(let v=0;v<V.length;v++)if(V[v].$ffId===void 0&&Object.defineProperty(V[v],"$ffId",{value:`${t.id}-${t.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),P=V[v].$ffId,R.push(P),!f[P])if(c){let I=o,z=m(()=>V[v]),T=$(z,I);f[P]={validationConfigs:[T],validationState:T.validationState}}else{let I=V[v],T=x(I,o);f[P]={validationConfigs:T.validationConfigs,validationState:T.state}}let A=[];for(let v=0;v<R.length;v++)A.push(f[R[v]].validationState);return console.timeEnd("array state"),A})}),l=!(((r=(u=i.$lazy)==null?void 0:u.length)!=null?r:-1)>0),d=!(((y=(s=i.$reactive)==null?void 0:s.length)!=null?y:-1)>0),t={id:M.value++,validationIterationId:0,reactiveIsValid:g(d),reactiveValidationResults:g([]),validatingReactive:g(!1),lazyIsValid:g(l),lazyValidationResults:g([]),validatingLazy:g(!1),validation:i,syncValidators:{},asyncValidators:{},property:a,validationState:n,arrayConfigMap:{},hasElementValidation:e,elementId:0,elementValidation:i.$each};return t}function x(a,i){let e=[],n={};console.log("Performing complex validation setup",i),i!=null&&l(a,i);function l(d,t){for(let u in t){let r=m(()=>d[u]),s=(t==null?void 0:t.$reactive)!=null||(t==null?void 0:t.$lazy)!=null||(t==null?void 0:t.$each)!=null;if(s){let y=t[u],V=$(r,y);e.push(V),n[u]=V.validationState}else if(s==!1){let y={},V=t[u];n[u]=y,l(r,V)}}}return{validationConfigs:e,state:n}}export{G as bufferAsync,q as isEmailSync,U as maximumLength,Z as minValue,Q as minimumLength,D as required,F as throttleQueueAsync,w as useValidation,J as validateIf};
