var K=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var B=(a,t)=>{for(var e in t)K(a,e,{get:t[e],enumerable:!0})},L=(a,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of w(t))!k.call(a,l)&&l!==e&&K(a,l,{get:()=>t[l],enumerable:!(n=j(t,l))||n.enumerable});return a};var N=a=>L(K({},"__esModule",{value:!0}),a);var A=(a,t,e)=>new Promise((n,l)=>{var V=s=>{try{c(e.next(s))}catch(d){l(d)}},i=s=>{try{c(e.throw(s))}catch(d){l(d)}},c=s=>s.done?n(s.value):Promise.resolve(s.value).then(V,i);c((e=e.apply(a,t)).next())});var Q={};B(Q,{bufferAsync:()=>z,minimumLength:()=>G,throttleQueueAsync:()=>T,useValidation:()=>O});module.exports=N(Q);function z(a){let t=0,e;return(...n)=>{var V;let l=++t;return e=(V=e==null?void 0:e.then(()=>{if(t==l)return e=a(...n).then(i=>(e=void 0,i)),e}))!=null?V:a(...n).then(i=>(e=void 0,i)),e}}function T(a,t){let e=0,n;return(...l)=>new Promise(V=>{let i=++e,c=new Date().getTime();n!=null||(n=c-t);let s=c-n-t;s<0?new Promise(d=>setTimeout(d,-1*s)).then(()=>{n=new Date().getTime(),i==e&&V(a(...l)),V(void 0)}):(n=c,V(a(...l)))})}function S(a,t=e=>e){return a.reduce((e,n)=>{if(n!=null){let l=t(n);l!=null&&e.push(l)}return e},[])}function h(a){return a.reduce((t,e)=>{if(e!=null)if(e instanceof Array)for(let n of e)n!=null&&t.push(n);else t.push(e);return t},[])}function G(a){return t=>{var n;let e=String((n=t.value)!=null?n:"");return{isValid:e.length>=a,errorMessage:`Too short (${e.length} / ${a})`}}}var u=require("vue");var E=(0,u.ref)(0);function O(a){var m;(m=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:t,validation:e,delayReactiveValidation:n,args:l}=a,V=(0,u.ref)(!1),i=(0,u.computed)(()=>s.some(P=>P.validationState.isValidating)),c=(0,u.computed)(()=>s.every(g=>g.reactiveIsValid.value&&g.lazyIsValid.value)),s=[],d=(0,u.reactive)({}),v=(0,u.ref)(JSON.stringify(a.objectToValidate.value)),o=(0,u.computed)(()=>v.value!==JSON.stringify(a.objectToValidate.value));if((e==null?void 0:e.$reactive)!=null||(e==null?void 0:e.$lazy)!=null){let R=I(t,e);d=(0,u.reactive)(R.validationState),s=[R]}else{let P=t,g=e,R=M(P.value,g);d=(0,u.reactive)(R.state),s=R.validationConfigs}(0,u.watch)(a.objectToValidate,()=>{n?V.value==!0&&b(s,t,l,!0,!1):b(s,t,l,!0,!1)},{deep:!0});function f(){return A(this,null,function*(){let P=yield b(s,t,l,!0,!0);return V.value=!0,P})}function y(P){v.value=JSON.stringify(P)}return(0,u.reactive)({hasValidated:V,validate:f,isValidating:i,propertyState:d,isValid:c,setReference:y,isDirty:o})}function D(a,t,e,n){return A(this,null,function*(){var v,o;if(a.validation.$reactive==null)return!0;a.validatingReactive.value=!0;let l=a.validation.$reactive,V=!0;(a.syncValidators.$reactive||a.asyncValidators.$reactive)&&(V=!1,l=((v=a.syncValidators.$reactive)!=null?v:[]).concat((o=a.asyncValidators.$reactive)!=null?o:[]));let i=!0,c=0;function s(r){let f;if(n==a.validationIterationId)for(let y=0;y<r.length;y++)r[y].isValid==!1&&(i=!1),r[y].identifier=`validator-reactive-${a.id}-${c++}`,f=a.reactiveValidationResults.value.find(m=>m.identifier==r[y].identifier),f!=null?Object.assign(f,r[y]):a.reactiveValidationResults.value.push(r[y])}let d=x(a.property.value,t,e,l,s);if(V){let r=[];for(let f of d.asyncValidators)r.push(T(f,1e3));a.asyncValidators.$reactive=r,a.syncValidators.$reactive=d.syncValidators}return s(d.syncResults),yield Promise.all(d.asyncPromises),n==a.validationIterationId&&(a.reactiveIsValid.value=i,a.validatingReactive.value=!1),a.reactiveIsValid.value})}function J(a,t,e,n){return A(this,null,function*(){var v,o;if(a.validation.$lazy==null)return!0;a.validatingLazy.value=!0;let l=!0,V=0,i=!0,c=a.validation.$lazy;(a.syncValidators.$lazy||a.asyncValidators.$lazy)&&(i=!1,c=((v=a.syncValidators.$lazy)!=null?v:[]).concat((o=a.asyncValidators.$lazy)!=null?o:[]));function s(r){let f;if(n==a.validationIterationId)for(let y=0;y<r.length;y++)r[y].isValid==!1&&(l=!1),r[y].identifier=`validator-lazy-${a.id}-${V++}`,f=a.lazyValidationResults.value.find(m=>m.identifier==r[y].identifier),f!=null?Object.assign(f,r[y]):a.lazyValidationResults.value.push(r[y])}let d=x(a.property.value,t,e,c,s);if(i){let r=[];for(let f of d.asyncValidators)r.push(T(f,500));a.asyncValidators.$lazy=r,a.syncValidators.$lazy=d.syncValidators}return s(d.syncResults),yield Promise.all(d.asyncPromises),n==a.validationIterationId&&(a.lazyIsValid.value=l,a.validatingLazy.value=!1),a.lazyIsValid.value})}function b(a,t,e,n,l){return A(this,null,function*(){let V=[];for(let i of a){let c=++i.validationIterationId;if(n&&V.push(D(i,t.value,e,c)),l&&V.push(J(i,t.value,e,c)),i.elementValidation!=null){let s=[];for(let d in i.arrayConfigMap)s.push(...i.arrayConfigMap[d].validationConfigs);V.push(b(s,t,e,n,l))}}return Promise.all(V).then(i=>i.every(c=>c==!0))})}function x(a,t,e,n=[],l){let V=[],i=[],c=[],s=[];for(let d of n){let v=d({value:a,parent:t,args:e});v instanceof Promise?(V.push(v.then(o=>o?l([o]):void 0)),s.push(d)):(i.push(v),c.push(d))}return{syncResults:i,asyncPromises:V,syncValidators:c,asyncValidators:s}}function I(a,t){var c,s,d,v;let e=t.$each!=null,n=(0,u.reactive)({isValid:(0,u.computed)(()=>{var f,y;let o=(f=i.lazyIsValid.value)!=null?f:!1,r=(y=i.reactiveIsValid.value)!=null?y:!1;return o&&r}),isValidating:(0,u.computed)(()=>i.validatingReactive.value||i.validatingLazy.value),isErrored:(0,u.computed)(()=>n.validationResults.some(o=>o.isValid==!1)),errorMessages:(0,u.computed)(()=>h(S(n.validationResults,o=>o.isValid?void 0:o.errorMessage))),validationResults:(0,u.computed)(()=>{var o,r;return((o=i.reactiveValidationResults.value)!=null?o:[]).concat((r=i.lazyValidationResults.value)!=null?r:[])}),arrayState:(0,u.computed)(()=>{if(Array.isArray(a.value)){let o=a.value,r=i.elementValidation,f=i.arrayConfigMap,y=(r==null?void 0:r.$reactive)!=null||(r==null?void 0:r.$lazy)!=null,m,P=[];for(let R=0;R<o.length;R++)if(o[R].$ffId===void 0&&Object.defineProperty(o[R],"$ffId",{value:`${i.id}-${i.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),m=o[R].$ffId,P.push(m),!f[m])if(y){let F=r,$=(0,u.computed)(()=>o[R]),p=I($,F);f[m]={validationConfigs:[p],validationState:p.validationState}}else{let F=o[R],p=M(F,r);f[m]={validationConfigs:p.validationConfigs,validationState:p.state}}let g=[];for(let R=0;R<P.length;R++)g.push(f[P[R]].validationState);return g}else return})}),l=!(((s=(c=t.$lazy)==null?void 0:c.length)!=null?s:-1)>0),V=!(((v=(d=t.$reactive)==null?void 0:d.length)!=null?v:-1)>0),i={id:E.value++,validationIterationId:0,reactiveIsValid:(0,u.ref)(V),reactiveValidationResults:(0,u.ref)([]),validatingReactive:(0,u.ref)(!1),lazyIsValid:(0,u.ref)(l),lazyValidationResults:(0,u.ref)([]),validatingLazy:(0,u.ref)(!1),validation:t,syncValidators:{},asyncValidators:{},property:a,validationState:n,arrayConfigMap:{},hasElementValidation:e,elementId:0,elementValidation:t.$each};return i}function M(a,t){let e=[],n={};t!=null&&l(a,t);function l(V,i){var c,s;for(let d in i){let v=(0,u.computed)(()=>V[d]),o=((c=i[d])==null?void 0:c.$reactive)!=null||((s=i[d])==null?void 0:s.$lazy)!=null;if(o){let r=i[d],f=I(v,r);e.push(f),n[d]=f.validationState}else if(o==!1){let r={},f=i[d];n[d]=r,l(v,f)}}}return{validationConfigs:e,state:n}}0&&(module.exports={bufferAsync,minimumLength,throttleQueueAsync,useValidation});
