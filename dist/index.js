var O=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var Z=(a,e)=>{for(var t in e)O(a,t,{get:e[t],enumerable:!0})},W=(a,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of E(e))!U.call(a,r)&&r!==t&&O(a,r,{get:()=>e[r],enumerable:!(i=q(e,r))||i.enumerable});return a};var H=a=>W(O({},"__esModule",{value:!0}),a);var b=(a,e,t)=>new Promise((i,r)=>{var o=n=>{try{V(t.next(n))}catch(l){r(l)}},d=n=>{try{V(t.throw(n))}catch(l){r(l)}},V=n=>n.done?i(n.value):Promise.resolve(n.value).then(o,d);V((t=t.apply(a,e)).next())});var ra={};Z(ra,{bufferAsync:()=>K,isEmailSync:()=>ta,maximumLength:()=>aa,minValue:()=>ea,minimumLength:()=>_,required:()=>X,throttleQueueAsync:()=>T,useValidation:()=>Q,validateIf:()=>Y});module.exports=H(ra);function K(a){let e=0,t;return(...i)=>{var o;let r=++e;return t=(o=t==null?void 0:t.then(()=>{if(e==r)return t=a(...i).then(d=>(t=void 0,d)),t}))!=null?o:a(...i).then(d=>(t=void 0,d)),t}}function T(a,e){let t=0,i;return(...r)=>new Promise(o=>{let d=++t,V=new Date().getTime();i!=null||(i=V-e);let n=V-i-e;n<0?new Promise(l=>setTimeout(l,-1*n)).then(()=>{i=new Date().getTime(),d==t&&o(a(...r)),o(void 0)}):(i=V,o(a(...r)))})}function k(a,e=t=>t){return a.reduce((t,i)=>{if(i!==void 0){let r=e(i);r!==void 0&&t.push(r)}return t},[])}function L(a){return a.reduce((e,t)=>{if(t!==void 0)if(t instanceof Array)for(let i of t)i!==void 0&&e.push(i);else e.push(t);return e},[])}function X(){return a=>({isValid:a.value!==void 0&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function Y(a,e){return t=>b(this,null,function*(){return(yield a(t))===!1?{isValid:!0}:e})}function _(a){return e=>{var i;let t=String((i=e.value)!=null?i:"");return{isValid:t.length>=a,errorMessage:`Too short (${t.length} / ${a})`}}}function aa(a){return e=>{var t,i,r,o;return{isValid:((i=(t=e.value)==null?void 0:t.length)!=null?i:0)<=a,errorMessage:`Too long (${(o=(r=e.value)==null?void 0:r.length)!=null?o:0} / ${a})`}}}function ea(a){return e=>({isValid:e.value!==void 0&&e.value>=a,errorMessage:`Must be atleast ${a}`})}function ta(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}var R=require("vue");var D=require("vue");var v=require("vue");function C(){return`${Date.now()}-${Math.floor(Math.random()*1e3)}`}function G(a,e,t){let i=[],r=o=>`${e?"reactive":"lazy"}-${C()}`;t!=null&&(r=o=>`${t}-${o}`);for(let[o,d]of a.entries())i.push({validatorId:r(o),validator:d,optimized:!1,isReactive:e,previouslyReturnedValidators:!1,previouslySpawnedValidators:{},spawnedValidators:{}});return i}function h(a,e,t=[]){var l,P,u,s;let i=(0,v.reactive)({isValid:(0,v.computed)(()=>{var y,c;let f=(y=n.isLazyValid.value)!=null?y:!1,p=(c=n.isReactiveValid.value)!=null?c:!1;return f&&p}),isValidating:(0,v.computed)(()=>n.isValidatingReactive.value||n.isValidatingLazy.value),isErrored:(0,v.computed)(()=>i.resultsArray.some(f=>f.isValid===!1)),errorMessages:(0,v.computed)(()=>L(k(i.resultsArray,f=>f.isValid?void 0:f.errorMessage))),results:(0,v.computed)(()=>n.namedValidationResults.value),resultsArray:(0,v.computed)(()=>n.validationResults.value),arrayState:(0,v.computed)(()=>{if(Array.isArray(a.value)===!1||n.elementValidation===void 0)return[];console.time("Array state");let f=a.value,p=n.elementValidation,y=n.arrayConfigMap,c=[],A={},m,x=[];for(let g=0;g<f.length;g++){if(f[g]!==void 0&&typeof f[g]=="object"?(f[g].$ffId===void 0&&Object.defineProperty(f[g],"$ffId",{value:`${n.id}-${n.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),m=f[g].$ffId):f[g]!==void 0&&(y[g]===void 0?m=g:console.log(y[g].validationConfigs[0].property.value)),x.push(m),y[m]){c.push(y[m].validationState),A[m]=y[m];continue}let w=(0,v.computed)(()=>f[g]);if(S(p)){let I=h(w,p,n.arrayParents.concat(w));y[m]={validationConfigs:[I],validationState:I.validationState}}else{let j=f[g],M=z(j,p,n.arrayParents.concat(w));y[m]={validationConfigs:M.validationConfigs,validationState:M.state}}c.push(y[m].validationState),A[m]=y[m]}return n.arrayConfigMap=A,console.timeEnd("Array state"),c})}),r=!(((P=(l=e.$lazy)==null?void 0:l.length)!=null?P:-1)>0),o=!(((s=(u=e.$reactive)==null?void 0:u.length)!=null?s:-1)>0),d=e.$reactive?G(e.$reactive,!0):[],V=e.$lazy?G(e.$lazy,!1):[],n={id:C(),validationIterationId:0,isReactiveValid:(0,v.ref)(o),isValidatingReactive:(0,v.ref)(!1),reactiveProcessedValidators:d,isLazyValid:(0,v.ref)(r),isValidatingLazy:(0,v.ref)(!1),lazyProcessedValidators:V,property:a,validation:e,validationState:i,validationResults:(0,v.ref)([]),namedValidationResults:(0,v.ref)({}),arrayConfigMap:{},elementId:0,elementValidation:e.$each,arrayParents:(0,v.reactive)(t)};return n}function z(a,e,t=[]){let i=[],r={};e!==void 0&&o(a,e);function o(d,V){for(let n in V){let l=(0,v.computed)(()=>d[n]);if(S(V[n])){let P=V[n],u=h(l,P,t);i.push(u),r[n]=u.validationState}else{let P={},u=V[n];r[n]=P,o(l,u)}}}return{validationConfigs:i,state:r}}function S(a){return(a==null?void 0:a.$reactive)!==void 0||(a==null?void 0:a.$lazy)!==void 0||(a==null?void 0:a.$each)!==void 0}var $=500;function B(a,e,t,i,r){return b(this,null,function*(){let o=!0,d=(l,P,u)=>{if(i!==l.validationIterationId)return;u.isValid===!1&&(o=!1),u.id=P.validatorId;let s=l.validationResults.value.find(f=>f.id===u.id);s!==void 0?(Object.assign(s,u),u.name!==void 0&&l.namedValidationResults[u.name]!==void 0&&Object.assign(l.namedValidationResults.value[u.name],u)):(l.validationResults.value.push(u),u.name!==void 0&&(l.namedValidationResults.value[u.name]=u))},{asyncPromises:V,validatorsWhichPreviouslyReturnedValidators:n}=J(a,e,t,i,r,d,!0,1);if(yield Promise.all(V),i===a.validationIterationId){for(let l of n)for(let P of Object.keys(l.previouslySpawnedValidators))if(l.spawnedValidators[P]==null){let u=a.validationResults.value.findIndex(s=>s.id===P);u!==-1&&a.validationResults.value.splice(u)}}return o})}function J(a,e,t,i,r,o,d,V){let n=a.property.value,l=[],P=[],u=[];for(let s of r){let f=!1;s.previouslyReturnedValidators&&(s.previouslySpawnedValidators=s.spawnedValidators,s.spawnedValidators={},f=!0),s.previouslyReturnedValidators=!1;let p;if(s.computedValidator===void 0){let y={value:n,parent:e,args:t,arrayParents:a.arrayParents.map(c=>c.value)};p=s.validator(y)}else p=s.computedValidator.value;if(p instanceof Promise){let y=Date.now();l.push(p.then(c=>b(this,null,function*(){if(c===void 0){f&&u.push(s);return}let A=Date.now()-y;if(d&&A>$&&s.optimized===!1&&(s.optimized=!0,A<2*$?s.validator=T(s.validator,$):s.validator=K(s.validator)),Array.isArray(c)){let{asyncPromises:m,syncResults:x}=N(a,e,t,i,o,s,c,V);P.push(...x),yield Promise.all(m);return}else f&&u.push(s);o(a,s,c)})))}else if(Array.isArray(p)){let{asyncPromises:y,syncResults:c}=N(a,e,t,i,o,s,p,V);l.push(...y),P.push(...c)}else if(f&&u.push(s),p!==void 0){if(d&&s.optimized===!1){let y=s.validator;s.computedValidator=(0,D.computed)(()=>{let c={value:a.property.value,parent:e,args:t,arrayParents:a.arrayParents.map(A=>A.value)};return y(c)}),s.optimized=!0,s.validator=()=>s.computedValidator.value}P.push(p),o(a,s,p)}}return{asyncPromises:l,syncResults:P,validatorsWhichPreviouslyReturnedValidators:u}}function N(a,e,t,i,r,o,d,V){let n=G(d,o.isReactive,o.validatorId),l=J(a,e,t,i,n,r,!1,++V),P={};for(let u of n)P[u.validatorId]=u;return o.spawnedValidators=P,o.previouslyReturnedValidators=!0,l}function ia(a,e,t,i){return b(this,null,function*(){a.isValidatingReactive.value=!0;let r=yield B(a,e,t,i,a.reactiveProcessedValidators);return i===a.validationIterationId&&(a.isReactiveValid.value=r,a.isValidatingReactive.value=!1),a.isReactiveValid.value})}function na(a,e,t,i){return b(this,null,function*(){a.isValidatingLazy.value=!0;let r=a.lazyProcessedValidators,o=yield B(a,e,t,i,r);return i===a.validationIterationId&&(a.isLazyValid.value=o,a.isValidatingLazy.value=!1),a.isLazyValid.value})}function F(a,e,t,i,r){return b(this,null,function*(){let o=[];for(let d of a){let V=++d.validationIterationId;if(i&&d.validation.$reactive!==void 0&&o.push(yield ia(d,e.value,t,V)),r&&d.validation.$lazy!==void 0&&o.push(yield na(d,e.value,t,V)),d.elementValidation!==void 0){let n=[];for(let l in d.arrayConfigMap)n.push(...d.arrayConfigMap[l].validationConfigs);o.push(yield F(n,e,t,i,r))}}return Promise.all(o).then(d=>d.every(V=>V===!0))})}function Q(a){var y;(y=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:e,validation:t,delayReactiveValidation:i,args:r}=a,o=(0,R.ref)(!1),d=(0,R.computed)(()=>n.some(c=>c.validationState.isValidating)),V=(0,R.computed)(()=>n.every(A=>A.isReactiveValid.value&&A.isLazyValid.value)),n=[],l=(0,R.reactive)({}),P=(0,R.ref)(JSON.stringify(a.objectToValidate.value)),u=(0,R.computed)(()=>P.value!==JSON.stringify(a.objectToValidate.value));if(S(t)){let m=h(e,t);l=(0,R.reactive)(m.validationState),n=[m]}else{let c=e,A=t,m=z(c.value,A);l=(0,R.reactive)(m.state),n=m.validationConfigs}(0,R.watch)(a.objectToValidate,()=>{i?o.value===!0&&F(n,e,r,!0,!1):F(n,e,r,!0,!1)},{deep:!0});function f(){return b(this,null,function*(){let c=yield F(n,e,r,!0,!0);return o.value=!0,c})}function p(c){P.value=JSON.stringify(c)}return(0,R.reactive)({hasValidated:o,validate:f,isValidating:d,propertyState:(0,R.computed)(()=>l),isValid:V,setReference:p,isDirty:u})}0&&(module.exports={bufferAsync,isEmailSync,maximumLength,minValue,minimumLength,required,throttleQueueAsync,useValidation,validateIf});
