var w=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var Z=(a,t)=>{for(var e in t)w(a,e,{get:t[e],enumerable:!0})},W=(a,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of E(t))!U.call(a,r)&&r!==e&&w(a,r,{get:()=>t[r],enumerable:!(i=q(t,r))||i.enumerable});return a};var H=a=>W(w({},"__esModule",{value:!0}),a);var b=(a,t,e)=>new Promise((i,r)=>{var o=n=>{try{u(e.next(n))}catch(V){r(V)}},d=n=>{try{u(e.throw(n))}catch(V){r(V)}},u=n=>n.done?i(n.value):Promise.resolve(n.value).then(o,d);u((e=e.apply(a,t)).next())});var ra={};Z(ra,{bufferAsync:()=>T,isEmailSync:()=>ta,maximumLength:()=>aa,minValue:()=>ea,minimumLength:()=>_,required:()=>X,throttleQueueAsync:()=>h,useValidation:()=>Q,validateIf:()=>Y});module.exports=H(ra);function T(a){let t=0,e;return(...i)=>{var o;let r=++t;return e=(o=e==null?void 0:e.then(()=>{if(t==r)return e=a(...i).then(d=>(e=void 0,d)),e}))!=null?o:a(...i).then(d=>(e=void 0,d)),e}}function h(a,t){let e=0,i;return(...r)=>new Promise(o=>{let d=++e,u=new Date().getTime();i!=null||(i=u-t);let n=u-i-t;n<0?new Promise(V=>setTimeout(V,-1*n)).then(()=>{i=new Date().getTime(),d==e&&o(a(...r)),o(void 0)}):(i=u,o(a(...r)))})}function M(a,t=e=>e){return a.reduce((e,i)=>{if(i!==void 0){let r=t(i);r!==void 0&&e.push(r)}return e},[])}function k(a){return a.reduce((t,e)=>{if(e!==void 0)if(e instanceof Array)for(let i of e)i!==void 0&&t.push(i);else t.push(e);return t},[])}function X(){return a=>({isValid:a.value!=null&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function Y(a,t){return e=>b(this,null,function*(){return a(e)==!1?{isValid:!0}:t})}function _(a){return t=>{var i;let e=String((i=t.value)!=null?i:"");return{isValid:e.length>=a,errorMessage:`Too short (${e.length} / ${a})`}}}function aa(a){return t=>{var e,i,r,o;return{isValid:((i=(e=t.value)==null?void 0:e.length)!=null?i:0)<=a,errorMessage:`Too long (${(o=(r=t.value)==null?void 0:r.length)!=null?o:0} / ${a})`}}}function ea(a){return t=>({isValid:t.value!=null&&t.value>=a,errorMessage:`Must be atleast ${a}`})}function ta(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}var p=require("vue");var L=require("vue");var m=require("vue");function C(){return`${Date.now()}-${Math.floor(Math.random()*1e3)}`}function G(a,t,e){let i=[],r=o=>`${t?"reactive":"lazy"}-${C()}`;e!=null&&(r=o=>`${e}-${o}`);for(let[o,d]of a.entries())i.push({validatorId:r(o),validator:d,optimized:!1,isReactive:t,previouslyReturnedValidators:!1,previouslySpawnedValidators:{},spawnedValidators:{}});return i}function S(a,t,e=[]){var V,c,f,s;let i=(0,m.reactive)({isValid:(0,m.computed)(()=>{var P,l;let y=(P=n.lazyIsValid.value)!=null?P:!1,v=(l=n.reactiveIsValid.value)!=null?l:!1;return y&&v}),isValidating:(0,m.computed)(()=>n.validatingReactive.value||n.validatingLazy.value),isErrored:(0,m.computed)(()=>i.validationResults.some(y=>y.isValid==!1)),errorMessages:(0,m.computed)(()=>k(M(i.validationResults,y=>y.isValid?void 0:y.errorMessage))),validationResults:(0,m.computed)(()=>n.validationResults.value),arrayState:(0,m.computed)(()=>{if(Array.isArray(a.value)===!1||n.elementValidation===void 0)return[];let y=a.value,v=n.elementValidation,P=n.arrayConfigMap,l,R=[];for(let A=0;A<y.length;A++){if(y[A].$ffId===void 0&&Object.defineProperty(y[A],"$ffId",{value:`${n.id}-${n.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),l=y[A].$ffId,R.push(l),P[l])continue;let I=(0,m.computed)(()=>y[A]);if(N(v)){let x=S(I,v,n.arrayParents.concat(I));P[l]={validationConfigs:[x],validationState:x.validationState}}else{let z=y[A],j=O(z,v,n.arrayParents.concat(I));P[l]={validationConfigs:j.validationConfigs,validationState:j.state}}}let g=[],K={};for(let A of R)g.push(P[A].validationState),K[A]=P[A];return n.arrayConfigMap=K,g})}),r=!(((c=(V=t.$lazy)==null?void 0:V.length)!=null?c:-1)>0),o=!(((s=(f=t.$reactive)==null?void 0:f.length)!=null?s:-1)>0),d=t.$reactive?G(t.$reactive,!0):[],u=t.$lazy?G(t.$lazy,!1):[],n={id:C(),validationIterationId:0,reactiveIsValid:(0,m.ref)(o),validatingReactive:(0,m.ref)(!1),reactiveProcessedValidators:d,lazyIsValid:(0,m.ref)(r),validatingLazy:(0,m.ref)(!1),lazyProcessedValidators:u,property:a,validation:t,validationState:i,validationResults:(0,m.ref)([]),arrayConfigMap:{},elementId:0,elementValidation:t.$each,arrayParents:(0,m.reactive)(e)};return n}function O(a,t,e=[]){let i=[],r={};t!==void 0&&o(a,t);function o(d,u){for(let n in u){let V=(0,m.computed)(()=>d[n]);if(N(u[n])){let c=u[n],f=S(V,c,e);i.push(f),r[n]=f.validationState}else{let c={},f=u[n];r[n]=c,o(V,f)}}}return{validationConfigs:i,state:r}}function N(a){return(a==null?void 0:a.$reactive)!==void 0||(a==null?void 0:a.$lazy)!==void 0||(a==null?void 0:a.$each)!==void 0}var $=500;function B(a,t,e,i,r){return b(this,null,function*(){let o=!0,d=(V,c)=>{if(r!==a.validationIterationId)return;c.isValid===!1&&(o=!1),c.identifier=V.validatorId;let f=a.validationResults.value.find(s=>s.identifier===c.identifier);f!==void 0?Object.assign(f,c):a.validationResults.value.push(c)},{asyncPromises:u,validatorsWhichPreviouslyReturnedValidators:n}=J(a,t,e,i,r,d,!0,1);if(yield Promise.all(u),r===a.validationIterationId){for(let V of n)for(let c of Object.keys(V.previouslySpawnedValidators))if(V.spawnedValidators[c]==null){let f=a.validationResults.value.findIndex(s=>s.identifier===c);f!==-1&&a.validationResults.value.splice(f)}}return o})}function J(a,t,e,i,r,o,d,u){let n=a.property.value,V=[],c=[],f=[];for(let s of i){let y=!1;s.previouslyReturnedValidators&&(s.previouslySpawnedValidators=s.spawnedValidators,s.spawnedValidators={},y=!0),s.previouslyReturnedValidators=!1;let v;if(s.computedValidator===void 0){let P={value:n,parent:t,args:e,arrayParents:a.arrayParents.map(l=>l.value)};v=s.validator(P)}else v=s.computedValidator.value;if(v instanceof Promise){let P=Date.now();V.push(v.then(l=>b(this,null,function*(){if(l===void 0){y&&f.push(s);return}let R=Date.now()-P;if(d&&R>$&&s.optimized===!1&&(s.optimized=!0,R<2*$?s.validator=h(s.validator,$):s.validator=T(s.validator)),Array.isArray(l)){let{asyncPromises:g,syncResults:K}=D(a,t,e,r,o,s,l,u);c.push(...K),yield Promise.all(g);return}else y&&f.push(s);o(s,l)})))}else if(Array.isArray(v)){let{asyncPromises:P,syncResults:l}=D(a,t,e,r,o,s,v,u);V.push(...P),c.push(...l)}else if(y&&f.push(s),v!==void 0){if(d&&s.optimized===!1){let P=s.validator;s.computedValidator=(0,L.computed)(()=>{console.log("computed ran instead");let l={value:a.property.value,parent:t,args:e,arrayParents:a.arrayParents.map(R=>R.value)};return P(l)}),s.optimized=!0,s.validator=()=>s.computedValidator.value}c.push(v),o(s,v)}}return{asyncPromises:V,syncResults:c,validatorsWhichPreviouslyReturnedValidators:f}}function D(a,t,e,i,r,o,d,u){let n=G(d,o.isReactive,o.validatorId),V=J(a,t,e,n,i,r,!1,++u),c={};for(let f of n)c[f.validatorId]=f;return o.spawnedValidators=c,o.previouslyReturnedValidators=!0,V}function ia(a,t,e,i){return b(this,null,function*(){a.validatingReactive.value=!0;let r=a.reactiveProcessedValidators,o=yield B(a,t,e,r,i);return i===a.validationIterationId&&(a.reactiveIsValid.value=o,a.validatingReactive.value=!1),a.reactiveIsValid.value})}function na(a,t,e,i){return b(this,null,function*(){a.validatingLazy.value=!0;let r=a.lazyProcessedValidators,o=yield B(a,t,e,r,i);return i===a.validationIterationId&&(a.lazyIsValid.value=o,a.validatingLazy.value=!1),a.lazyIsValid.value})}function F(a,t,e,i,r){return b(this,null,function*(){let o=[];for(let d of a){let u=++d.validationIterationId;if(i&&d.validation.$reactive!==void 0&&o.push(ia(d,t.value,e,u)),r&&d.validation.$lazy!==void 0&&o.push(na(d,t.value,e,u)),d.elementValidation!==void 0){let n=[];for(let V in d.arrayConfigMap)n.push(...d.arrayConfigMap[V].validationConfigs);o.push(F(n,t,e,i,r))}}return Promise.all(o).then(d=>d.every(u=>u===!0))})}function Q(a){var P;(P=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:t,validation:e,delayReactiveValidation:i,args:r}=a,o=(0,p.ref)(!1),d=(0,p.computed)(()=>n.some(l=>l.validationState.isValidating)),u=(0,p.computed)(()=>n.every(R=>R.reactiveIsValid.value&&R.lazyIsValid.value)),n=[],V=(0,p.reactive)({}),c=(0,p.ref)(JSON.stringify(a.objectToValidate.value)),f=(0,p.computed)(()=>c.value!==JSON.stringify(a.objectToValidate.value));if((e==null?void 0:e.$reactive)!=null||(e==null?void 0:e.$lazy)!=null||(e==null?void 0:e.$each)!=null){let g=S(t,e);V=(0,p.reactive)(g.validationState),n=[g]}else{let l=t,R=e,g=O(l.value,R);V=(0,p.reactive)(g.state),n=g.validationConfigs}(0,p.watch)(a.objectToValidate,()=>{i?o.value==!0&&F(n,t,r,!0,!1):(console.time("Reactive validation"),F(n,t,r,!0,!1),console.timeEnd("Reactive validation"))},{deep:!0});function y(){return b(this,null,function*(){let l=yield F(n,t,r,!0,!0);return o.value=!0,l})}function v(l){c.value=JSON.stringify(l)}return(0,p.reactive)({hasValidated:o,validate:y,isValidating:d,propertyState:(0,p.computed)(()=>V),isValid:u,setReference:v,isDirty:f})}0&&(module.exports={bufferAsync,isEmailSync,maximumLength,minValue,minimumLength,required,throttleQueueAsync,useValidation,validateIf});
