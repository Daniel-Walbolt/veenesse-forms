var I=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var Z=(a,t)=>{for(var e in t)I(a,e,{get:t[e],enumerable:!0})},W=(a,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of E(t))!U.call(a,r)&&r!==e&&I(a,r,{get:()=>t[r],enumerable:!(i=q(t,r))||i.enumerable});return a};var H=a=>W(I({},"__esModule",{value:!0}),a);var b=(a,t,e)=>new Promise((i,r)=>{var o=n=>{try{c(e.next(n))}catch(d){r(d)}},u=n=>{try{c(e.throw(n))}catch(d){r(d)}},c=n=>n.done?i(n.value):Promise.resolve(n.value).then(o,u);c((e=e.apply(a,t)).next())});var ra={};Z(ra,{bufferAsync:()=>T,isEmailSync:()=>ta,maximumLength:()=>aa,minValue:()=>ea,minimumLength:()=>_,required:()=>X,throttleQueueAsync:()=>G,useValidation:()=>Q,validateIf:()=>Y});module.exports=H(ra);function T(a){let t=0,e;return(...i)=>{var o;let r=++t;return e=(o=e==null?void 0:e.then(()=>{if(t==r)return e=a(...i).then(u=>(e=void 0,u)),e}))!=null?o:a(...i).then(u=>(e=void 0,u)),e}}function G(a,t){let e=0,i;return(...r)=>new Promise(o=>{let u=++e,c=new Date().getTime();i!=null||(i=c-t);let n=c-i-t;n<0?new Promise(d=>setTimeout(d,-1*n)).then(()=>{i=new Date().getTime(),u==e&&o(a(...r)),o(void 0)}):(i=c,o(a(...r)))})}function M(a,t=e=>e){return a.reduce((e,i)=>{if(i!==void 0){let r=t(i);r!==void 0&&e.push(r)}return e},[])}function k(a){return a.reduce((t,e)=>{if(e!==void 0)if(e instanceof Array)for(let i of e)i!==void 0&&t.push(i);else t.push(e);return t},[])}function X(){return a=>({isValid:a.value!=null&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function Y(a,t){return e=>b(this,null,function*(){return a(e)==!1?{isValid:!0}:t})}function _(a){return t=>{var i;let e=String((i=t.value)!=null?i:"");return{isValid:e.length>=a,errorMessage:`Too short (${e.length} / ${a})`}}}function aa(a){return t=>{var e,i,r,o;return{isValid:((i=(e=t.value)==null?void 0:e.length)!=null?i:0)<=a,errorMessage:`Too long (${(o=(r=t.value)==null?void 0:r.length)!=null?o:0} / ${a})`}}}function ea(a){return t=>({isValid:t.value!=null&&t.value>=a,errorMessage:`Must be atleast ${a}`})}function ta(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}var R=require("vue");var D=require("vue");var P=require("vue");function L(){return`${Date.now()}-${Math.floor(Math.random()*1e3)}`}function h(a,t,e){let i=[],r=o=>`${t?"reactive":"lazy"}-${L()}`;e!=null&&(r=o=>`${e}-${o}`);for(let[o,u]of a.entries())i.push({validatorId:r(o),validator:u,optimized:!1,isReactive:t,previouslyReturnedValidators:!1,previouslySpawnedValidators:{},spawnedValidators:{}});return i}function S(a,t,e=[]){var d,f,l,s;let i=(0,P.reactive)({isValid:(0,P.computed)(()=>{var m,V;let y=(m=n.isLazyValid.value)!=null?m:!1,v=(V=n.isReactiveValid.value)!=null?V:!1;return y&&v}),isValidating:(0,P.computed)(()=>n.isValidatingReactive.value||n.isValidatingLazy.value),isErrored:(0,P.computed)(()=>i.resultsArray.some(y=>y.isValid==!1)),errorMessages:(0,P.computed)(()=>k(M(i.resultsArray,y=>y.isValid?void 0:y.errorMessage))),results:(0,P.computed)(()=>n.namedValidationResults.value),resultsArray:(0,P.computed)(()=>n.validationResults.value),arrayState:(0,P.computed)(()=>{if(Array.isArray(a.value)===!1||n.elementValidation===void 0)return[];let y=a.value,v=n.elementValidation,m=n.arrayConfigMap,V,p=[];for(let A=0;A<y.length;A++){if(y[A].$ffId===void 0&&Object.defineProperty(y[A],"$ffId",{value:`${n.id}-${n.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),V=y[A].$ffId,p.push(V),m[V])continue;let x=(0,P.computed)(()=>y[A]);if(N(v)){let w=S(x,v,n.arrayParents.concat(x));m[V]={validationConfigs:[w],validationState:w.validationState}}else{let z=y[A],j=O(z,v,n.arrayParents.concat(x));m[V]={validationConfigs:j.validationConfigs,validationState:j.state}}}let g=[],K={};for(let A of p)g.push(m[A].validationState),K[A]=m[A];return n.arrayConfigMap=K,g})}),r=!(((f=(d=t.$lazy)==null?void 0:d.length)!=null?f:-1)>0),o=!(((s=(l=t.$reactive)==null?void 0:l.length)!=null?s:-1)>0),u=t.$reactive?h(t.$reactive,!0):[],c=t.$lazy?h(t.$lazy,!1):[],n={id:L(),validationIterationId:0,isReactiveValid:(0,P.ref)(o),isValidatingReactive:(0,P.ref)(!1),reactiveProcessedValidators:u,isLazyValid:(0,P.ref)(r),isValidatingLazy:(0,P.ref)(!1),lazyProcessedValidators:c,property:a,validation:t,validationState:i,validationResults:(0,P.ref)([]),namedValidationResults:(0,P.ref)({}),arrayConfigMap:{},elementId:0,elementValidation:t.$each,arrayParents:(0,P.reactive)(e)};return n}function O(a,t,e=[]){let i=[],r={};t!==void 0&&o(a,t);function o(u,c){for(let n in c){let d=(0,P.computed)(()=>u[n]);if(N(c[n])){let f=c[n],l=S(d,f,e);i.push(l),r[n]=l.validationState}else{let f={},l=c[n];r[n]=f,o(d,l)}}}return{validationConfigs:i,state:r}}function N(a){return(a==null?void 0:a.$reactive)!==void 0||(a==null?void 0:a.$lazy)!==void 0||(a==null?void 0:a.$each)!==void 0}var $=500;function B(a,t,e,i,r){return b(this,null,function*(){let o=!0,u=(d,f,l)=>{if(i!==d.validationIterationId)return;l.isValid===!1&&(o=!1),l.id=f.validatorId;let s=d.validationResults.value.find(y=>y.id===l.id);s!==void 0?(Object.assign(s,l),l.name!==void 0&&d.namedValidationResults[l.name]!==void 0&&Object.assign(d.namedValidationResults.value[l.name],l)):(d.validationResults.value.push(l),l.name!==void 0&&(d.namedValidationResults.value[l.name]=l)),l.name&&console.log("Named results",d.namedValidationResults.value)},{asyncPromises:c,validatorsWhichPreviouslyReturnedValidators:n}=J(a,t,e,i,r,u,!0,1);if(yield Promise.all(c),i===a.validationIterationId){for(let d of n)for(let f of Object.keys(d.previouslySpawnedValidators))if(d.spawnedValidators[f]==null){let l=a.validationResults.value.findIndex(s=>s.id===f);l!==-1&&a.validationResults.value.splice(l)}}return o})}function J(a,t,e,i,r,o,u,c){let n=a.property.value,d=[],f=[],l=[];for(let s of r){let y=!1;s.previouslyReturnedValidators&&(s.previouslySpawnedValidators=s.spawnedValidators,s.spawnedValidators={},y=!0),s.previouslyReturnedValidators=!1;let v;if(s.computedValidator===void 0){let m={value:n,parent:t,args:e,arrayParents:a.arrayParents.map(V=>V.value)};v=s.validator(m)}else v=s.computedValidator.value;if(v instanceof Promise){let m=Date.now();d.push(v.then(V=>b(this,null,function*(){if(V===void 0){y&&l.push(s);return}let p=Date.now()-m;if(u&&p>$&&s.optimized===!1&&(s.optimized=!0,p<2*$?s.validator=G(s.validator,$):s.validator=T(s.validator)),Array.isArray(V)){let{asyncPromises:g,syncResults:K}=C(a,t,e,i,o,s,V,c);f.push(...K),yield Promise.all(g);return}else y&&l.push(s);o(a,s,V)})))}else if(Array.isArray(v)){let{asyncPromises:m,syncResults:V}=C(a,t,e,i,o,s,v,c);d.push(...m),f.push(...V)}else if(y&&l.push(s),v!==void 0){if(u&&s.optimized===!1){let m=s.validator;s.computedValidator=(0,D.computed)(()=>{let V={value:a.property.value,parent:t,args:e,arrayParents:a.arrayParents.map(p=>p.value)};return m(V)}),s.optimized=!0,s.validator=()=>s.computedValidator.value}f.push(v),o(a,s,v)}}return{asyncPromises:d,syncResults:f,validatorsWhichPreviouslyReturnedValidators:l}}function C(a,t,e,i,r,o,u,c){let n=h(u,o.isReactive,o.validatorId),d=J(a,t,e,i,n,r,!1,++c),f={};for(let l of n)f[l.validatorId]=l;return o.spawnedValidators=f,o.previouslyReturnedValidators=!0,d}function ia(a,t,e,i){return b(this,null,function*(){a.isValidatingReactive.value=!0;let r=yield B(a,t,e,i,a.reactiveProcessedValidators);return i===a.validationIterationId&&(a.isReactiveValid.value=r,a.isValidatingReactive.value=!1),a.isReactiveValid.value})}function na(a,t,e,i){return b(this,null,function*(){a.isValidatingLazy.value=!0;let r=a.lazyProcessedValidators,o=yield B(a,t,e,i,r);return i===a.validationIterationId&&(a.isLazyValid.value=o,a.isValidatingLazy.value=!1),a.isLazyValid.value})}function F(a,t,e,i,r){return b(this,null,function*(){let o=[];for(let u of a){let c=++u.validationIterationId;if(i&&u.validation.$reactive!==void 0&&o.push(yield ia(u,t.value,e,c)),r&&u.validation.$lazy!==void 0&&o.push(yield na(u,t.value,e,c)),u.elementValidation!==void 0){let n=[];for(let d in u.arrayConfigMap)n.push(...u.arrayConfigMap[d].validationConfigs);o.push(yield F(n,t,e,i,r))}}return Promise.all(o).then(u=>u.every(c=>c===!0))})}function Q(a){var m;(m=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:t,validation:e,delayReactiveValidation:i,args:r}=a,o=(0,R.ref)(!1),u=(0,R.computed)(()=>n.some(V=>V.validationState.isValidating)),c=(0,R.computed)(()=>n.every(p=>p.isReactiveValid.value&&p.isLazyValid.value)),n=[],d=(0,R.reactive)({}),f=(0,R.ref)(JSON.stringify(a.objectToValidate.value)),l=(0,R.computed)(()=>f.value!==JSON.stringify(a.objectToValidate.value));if((e==null?void 0:e.$reactive)!=null||(e==null?void 0:e.$lazy)!=null||(e==null?void 0:e.$each)!=null){let g=S(t,e);d=(0,R.reactive)(g.validationState),n=[g]}else{let V=t,p=e,g=O(V.value,p);d=(0,R.reactive)(g.state),n=g.validationConfigs}(0,R.watch)(a.objectToValidate,()=>{i?o.value==!0&&F(n,t,r,!0,!1):(console.time("Reactive validation"),F(n,t,r,!0,!1),console.timeEnd("Reactive validation"))},{deep:!0});function y(){return b(this,null,function*(){let V=yield F(n,t,r,!0,!0);return o.value=!0,V})}function v(V){f.value=JSON.stringify(V)}return(0,R.reactive)({hasValidated:o,validate:y,isValidating:u,propertyState:(0,R.computed)(()=>d),isValid:c,setReference:v,isDirty:l})}0&&(module.exports={bufferAsync,isEmailSync,maximumLength,minValue,minimumLength,required,throttleQueueAsync,useValidation,validateIf});
